
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../understanding-SIEM/understanding-SIEM.html">
      
      
        <link rel="next" href="../wazuh/wazuh.html">
      
      
      <link rel="icon" href="../images/Cyber Defence Kit logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.40">
    
    
      
        <title>Splunk - Cyber Defence Kit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8c3ca2c6.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Splunk - Cyber Defence Kit" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="./assets/images/social/splunk/splunk.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="None" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Splunk - Cyber Defence Kit" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="./assets/images/social/splunk/splunk.png" >
      
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#splunk" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Cyber Defence Kit" class="md-header__button md-logo" aria-label="Cyber Defence Kit" data-md-component="logo">
      
  <img src="../images/Cyber Defence Kit logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cyber Defence Kit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Splunk
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../index.html" class="md-tabs__link">
          
  
    
  
  Cyber Defence Kit

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Cyber Defence Kit" class="md-nav__button md-logo" aria-label="Cyber Defence Kit" data-md-component="logo">
      
  <img src="../images/Cyber Defence Kit logo.png" alt="logo">

    </a>
    Cyber Defence Kit
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cyber Defence Kit
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Cyber Defence Kit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../index.html" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Getting Started
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_1">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_2" >
        
          
          <label class="md-nav__link" for="__nav_1_2" id="__nav_1_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    About Cyber Defence Kit
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            About Cyber Defence Kit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../CDK-explained/CDK-explained.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cyber Defence Kit Explained
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../project-overview/project-overview.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Project Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_3" checked>
        
          
          <label class="md-nav__link" for="__nav_1_3" id="__nav_1_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    SIEM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_3">
            <span class="md-nav__icon md-icon"></span>
            SIEM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-SIEM/understanding-SIEM.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding SIEM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Splunk
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="splunk.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Splunk
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab-setup-for-proof-of-concept" class="md-nav__link">
    <span class="md-ellipsis">
      Lab Setup for Proof of Concept
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splunk-enterprise" class="md-nav__link">
    <span class="md-ellipsis">
      Splunk Enterprise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-firewall" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Firewall
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-and-configure-splunk-enterprise" class="md-nav__link">
    <span class="md-ellipsis">
      Install and Configure Splunk Enterprise
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingesting-fortigate-logs-through-sc4s-option-1" class="md-nav__link">
    <span class="md-ellipsis">
      Ingesting FortiGate Logs through SC4S (Option 1)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ingesting FortiGate Logs through SC4S (Option 1)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-indexes-for-sc4s" class="md-nav__link">
    <span class="md-ellipsis">
      Create indexes for SC4S
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-http-event-collector-hec-token-for-sc4s" class="md-nav__link">
    <span class="md-ellipsis">
      Create a HTTP Event Collector (HEC) token for SC4S
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-linux-for-sc4s" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Linux for SC4S
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-podman-offline-on-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      Install Podman offline on Ubuntu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-sc4s-container-while-offline" class="md-nav__link">
    <span class="md-ellipsis">
      Install SC4S container while offline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-ipv4-forwarding" class="md-nav__link">
    <span class="md-ellipsis">
      Configure IPv4 forwarding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingesting-fortigate-logs-through-fortigate-app-option-2" class="md-nav__link">
    <span class="md-ellipsis">
      Ingesting FortiGate Logs through FortiGate App (Option 2)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ingesting FortiGate Logs through FortiGate App (Option 2)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#add-data-input-on-splunk-server" class="md-nav__link">
    <span class="md-ellipsis">
      Add data input on Splunk server:
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-fortigate" class="md-nav__link">
    <span class="md-ellipsis">
      Configure FortiGate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-fortigate-to-send-syslog" class="md-nav__link">
    <span class="md-ellipsis">
      Configure FortiGate to send syslog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-cisco-isr-to-send-syslog" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Cisco ISR to send syslog
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splunk-universal-forwarder" class="md-nav__link">
    <span class="md-ellipsis">
      Splunk Universal Forwarder
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-sysmon-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Install Sysmon on Windows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-domain-account" class="md-nav__link">
    <span class="md-ellipsis">
      Create a Domain Account
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-rdp-for-domain-user-splunk-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Configure RDP for domain user splunk (optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-splunk-universal-forwarder-on-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Splunk Universal Forwarder on Windows
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-a-new-outbound-firewall-rule" class="md-nav__link">
    <span class="md-ellipsis">
      Create a new outbound Firewall rule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-splunk-apps" class="md-nav__link">
    <span class="md-ellipsis">
      Install Splunk Apps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-unix-app-and-create-unix-server-class-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Unix app and create unix server class (optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-windows-and-sysmon-apps-and-create-windows-server-class" class="md-nav__link">
    <span class="md-ellipsis">
      Configure Windows and Sysmon apps and create windows server class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-indexes" class="md-nav__link">
    <span class="md-ellipsis">
      Create Indexes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edit-config-files-for-windows-app" class="md-nav__link">
    <span class="md-ellipsis">
      Edit config files for Windows app
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edit-config-files-for-sysmon-app" class="md-nav__link">
    <span class="md-ellipsis">
      Edit config files for Sysmon app
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#edit-config-files-for-unix-app-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Edit config files for Unix app (optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annex-1-using-virtual-account-to-install-universal-forwarder-windows" class="md-nav__link">
    <span class="md-ellipsis">
      Annex 1: Using Virtual Account to install Universal Forwarder (Windows)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annex-2-configure-splunk-universal-forwarder-on-linux-optional" class="md-nav__link">
    <span class="md-ellipsis">
      Annex 2: Configure Splunk Universal Forwarder on Linux (optional)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#annex-3-manual-configuration-of-data-input-on-linux-host" class="md-nav__link">
    <span class="md-ellipsis">
      Annex 3: Manual configuration of data input on Linux host
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction-to-splunk" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Splunk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Splunk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-reports" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-alerts" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Alerts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#creating-dashboards" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Dashboards
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dashboard-studio" class="md-nav__link">
    <span class="md-ellipsis">
      Dashboard Studio
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../wazuh/wazuh.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wazuh
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1_4" >
        
          
          <label class="md-nav__link" for="__nav_1_4" id="__nav_1_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    IDS/IPS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_4">
            <span class="md-nav__icon md-icon"></span>
            IDS/IPS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../understanding-IDS-IPS/understanding-IDS-IPS.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Understanding IDS/IPS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../snort/snort.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Snort
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../suricata/suricata.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Suricata
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="splunk">Splunk</h1>
<p>Splunk Enterprise is a Security Information and Event Management (SIEM) tool usually installed on the server. It is designed for searching, analysing, and visualising data. It allows users to collect and ingest data, and search across various data types. Splunk Universal Forwarders are usually installed on clients to provide reliable, secure data collection and forward that data into Splunk Enterprise for indexing. This part of documentation focuses on installing and configuring Splunk. For Splunk, the main focus will be installing Splunk Enterprise and Universal Forwarder. </p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/p4Ta4ZvWsnY?si=Jcx5y8GqPmhBBldQ" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<h2 id="lab-setup-for-proof-of-concept">Lab Setup for Proof of Concept</h2>
<p>A virtual lab in an Unclassified environment is used as a proof of concept. Internet access was disabled during the installation to simulate an air-gapped environment. For a testing purpose, a free trial version was used for Splunk Enterprise and Universal Forwarder. Attack emulation was conducted on a FortiGate VM in a safe and controlled setting. </p>
<p>Note: Do not attempt to replicate the attack emulation demonstrated here unless you are properly trained and it is safe to do so. Unauthorised attack emulation can lead to legal consequences and unintended damage to systems. Always ensure that such activities are conducted by qualified professionals in a secure, isolated environment.</p>
<table>
<thead>
<tr>
<th><strong>Hostname</strong></th>
<th><strong>OS</strong></th>
<th><strong>Role</strong></th>
<th><strong>IP Address</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Fortigate</td>
<td>Fortios 7.6.0</td>
<td>Firewall/Router</td>
<td>192.168.1.111 (WAN)/10.0.0.1 (LAN)</td>
</tr>
<tr>
<td>SplunkEnt</td>
<td>Centos Stream 9</td>
<td>Splunk Enterprise (server), syslog server</td>
<td>10.0.0.120</td>
</tr>
<tr>
<td>WS2019-2</td>
<td>Windows Server 2019</td>
<td>Splunk Universal Forwarder (client)</td>
<td>10.0.0.140</td>
</tr>
<tr>
<td>Kali</td>
<td>Kali Linux 2024.2</td>
<td>Attacker machine</td>
<td>192.168.1.161, 10.0.0.29</td>
</tr>
</tbody>
</table>
<p><a class="glightbox" href="Splunk_PoC.drawio.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Splunk PoC.drawio.png" src="Splunk_PoC.drawio.png" /></a></p>
<h2 id="splunk-enterprise">Splunk Enterprise</h2>
<h2 id="configure-firewall">Configure Firewall</h2>
<p>On Ubuntu, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">514</span><span class="o">/</span><span class="nx">tcp</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">syslog</span><span class="w"> </span><span class="nx">TCP</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">514</span><span class="o">/</span><span class="nx">udp</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">syslog</span><span class="w"> </span><span class="nx">UDP</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">6514</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">syslog</span><span class="w"> </span><span class="nx">TLS</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">5425</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">syslog</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">601</span><span class="o">/</span><span class="nx">tcp</span><span class="w">  </span><span class="err">#</span><span class="w"> </span><span class="nx">syslog</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">8000</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">Web</span><span class="w"> </span><span class="nx">UI</span><span class="w"> </span><span class="nx">Port</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">8080</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">HEC</span><span class="w"> </span><span class="nx">Port</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">8088</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">HEC</span><span class="w"> </span><span class="nx">Port</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">8089</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">Management</span><span class="w"> </span><span class="nx">Port</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">9997</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">Data</span><span class="w"> </span><span class="nx">flow</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">8065</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">Appserver</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">allow</span><span class="w"> </span><span class="mf">8191</span><span class="o">/</span><span class="nx">tcp</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="nx">KVstore</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="err">#</span><span class="nx">Apply</span><span class="w"> </span><span class="nx">changes</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">reload</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="err">#</span><span class="nx">Enable</span><span class="w"> </span><span class="nx">Firewall</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="err">#</span><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">enable</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="err">#</span><span class="nx">Apply</span><span class="w"> </span><span class="nx">changes</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">ufw</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="nx">numbered</span>
</code></pre></div>
<p>On CentOS, run the following command:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1">#Show original state</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="nb">all</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="c1">#Syslog ports</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">514</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># syslog TCP</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">514</span><span class="o">/</span><span class="n">udp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># syslog UDP</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">5514</span><span class="o">/</span><span class="n">udp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># syslog UDP</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">6514</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># syslog TLS</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">5425</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># syslog</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">601</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># syslog</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="c1">#Splunk ports</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># Web UI Port</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">8080</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># HEC port</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">8088</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># HEC port</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">8089</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># Management Port</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">9997</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># Data flow</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">8065</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># appserver</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">zone</span><span class="o">=</span><span class="n">public</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">port</span><span class="o">=</span><span class="mi">8191</span><span class="o">/</span><span class="n">tcp</span> <span class="o">--</span><span class="n">permanent</span> <span class="c1"># kvstore</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="c1">#Apply changes</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="n">reload</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="c1">#Check applied</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="n">sudo</span> <span class="n">firewall</span><span class="o">-</span><span class="n">cmd</span> <span class="o">--</span><span class="nb">list</span><span class="o">-</span><span class="nb">all</span>
</code></pre></div>
<h2 id="install-and-configure-splunk-enterprise">Install and Configure Splunk Enterprise</h2>
<p>Splunk Enterprise enables you to search, analyze and visualise your data to quickly act on insights from across your technology landscape. This step focuses on installing and configuring Splunk Enterprise. </p>
<p>Note: Linux, 4.X, 5.10, 5.14,5.15 and 5.4.X kernels are ideal so Ubuntu 20.04 LTS or CentOS Stream 9 are recommended. As internet is required to register the system, RHEL is not recommended in an air-gapped environment. </p>
<p>Download <a href="https://www.splunk.com/en_us/download/splunk-enterprise.html">Splunk Enterprise</a> for Linux (.tgz).</p>
<p>Untar (unzip) the tar archive to /opt directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>sudo<span class="w"> </span>tar<span class="w"> </span>xvzf<span class="w"> </span>splunk-9.3.1-0b8d769cb912-Linux-x86_64.tgz<span class="w"> </span>-C<span class="w"> </span>/opt
</code></pre></div>
<p>Create user splunk and change ownership of /opt/splunk directory to the splunk user </p>
<p>On CentOS, after adding user, go to settings &gt; Users. Unlock to Change Settings. Set password for the <code>splunk</code> user</p>
<p>On Ubuntu, enter password and user information for the <code>splunk</code> user (use default values by pressing <code>enter</code> ). </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">sudo</span> <span class="n">adduser</span> <span class="n">splunk</span>
</code></pre></div>
<p>Make the splunk user the owner of the splunk directory. Change permissions and verify the ownership.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>splunk:splunk<span class="w"> </span>/opt/splunk
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="nb">cd</span><span class="w"> </span>/opt
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>ls<span class="w"> </span>-la
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="n">total</span> <span class="mi">12</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span>   <span class="n">root</span>   <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">18</span> <span class="mi">15</span><span class="p">:</span><span class="mi">36</span> <span class="o">.</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">20</span> <span class="n">root</span>   <span class="n">root</span>   <span class="mi">4096</span> <span class="n">Sep</span> <span class="mi">18</span> <span class="mi">15</span><span class="p">:</span><span class="mi">21</span> <span class="o">..</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">11</span> <span class="n">splunk</span> <span class="n">splunk</span> <span class="mi">4096</span> <span class="n">Sep</span>  <span class="mi">6</span> <span class="mi">05</span><span class="p">:</span><span class="mi">58</span> <span class="n">splunk</span>
</code></pre></div>
<p>Switch to splunk user and start splunk. When prompted, create admin credentials.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>su<span class="w"> </span>splunk
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nb">cd</span><span class="w"> </span>splunk/bin
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>./splunk<span class="w"> </span>start<span class="w"> </span>--accept-license
</code></pre></div>
<p>Wait for web server at <code>http://127.0.0.1:8000</code> to be available. Navigate to <code>http://&lt;IP address&gt;:8000</code>or <code>http://localhost:8000</code> on web browser.  </p>
<p>Enter in splunk admin credentials you created when installing Splunk Enterprise</p>
<p>Setup Splunk to listen on port 9997</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># in /opt/splunk/bin/</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>./splunk<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>listen<span class="w"> </span><span class="m">9997</span>
</code></pre></div>
<p>Alternatively this can be done on the web UI</p>
<p>Settings &gt; Forwarding and Receiving &gt; Add new under Receive Data &gt; Listen on this port: 9997 &gt; Save &gt; Verify the listen on port 9997 is enabled under Receive Data and Configure receiving</p>
<p><a class="glightbox" href="Untitled.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled.png" /></a></p>
<p><a class="glightbox" href="Untitled%201.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%201.png" /></a></p>
<p><a class="glightbox" href="Untitled%202.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%202.png" /></a></p>
<h2 id="ingesting-fortigate-logs-through-sc4s-option-1">Ingesting FortiGate Logs through SC4S (Option 1)</h2>
<p>SC4S is an open source packaged solution for getting data into Splunk. It is based on the syslog-ng Open Source Edition (Syslog-NG OSE) and transports data to Splunk via the Splunk HTTP event Collector (HEC) rather than writing events to disk for collection by a Universal Forwarder.</p>
<h3 id="create-indexes-for-sc4s">Create indexes for SC4S</h3>
<p>Copy indexes.conf from here:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="p">[</span><span class="n">default</span><span class="p">]</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">lastChanceIndex</span> <span class="o">=</span> <span class="n">main</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">[</span><span class="n">email</span><span class="p">]</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">email</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">email</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">email</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="p">[</span><span class="n">epav</span><span class="p">]</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">epav</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">epav</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">epav</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="p">[</span><span class="n">epintel</span><span class="p">]</span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">epintel</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">epintel</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">epintel</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="p">[</span><span class="n">fireeye</span><span class="p">]</span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">fireeye</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">fireeye</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">fireeye</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="p">[</span><span class="n">gitops</span><span class="p">]</span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">gitops</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">gitops</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">gitops</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="p">[</span><span class="n">infraops</span><span class="p">]</span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">infraops</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">infraops</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">infraops</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="p">[</span><span class="n">netauth</span><span class="p">]</span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netauth</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netauth</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netauth</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="p">[</span><span class="n">netdlp</span><span class="p">]</span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netdlp</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netdlp</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netdlp</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="p">[</span><span class="n">netdns</span><span class="p">]</span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netdns</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netdns</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netdns</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="p">[</span><span class="n">netfw</span><span class="p">]</span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netfw</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netfw</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netfw</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a><span class="p">[</span><span class="n">netids</span><span class="p">]</span>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netids</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netids</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netids</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="p">[</span><span class="n">netlb</span><span class="p">]</span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netlb</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netlb</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netlb</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a><span class="p">[</span><span class="n">netops</span><span class="p">]</span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netops</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netops</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netops</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a><span class="p">[</span><span class="n">netwaf</span><span class="p">]</span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netwaf</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netwaf</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netwaf</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a><span class="p">[</span><span class="n">netproxy</span><span class="p">]</span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netproxy</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netproxy</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netproxy</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a>
<a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a><span class="p">[</span><span class="n">netipam</span><span class="p">]</span>
<a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netipam</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netipam</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">netipam</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a>
<a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a><span class="p">[</span><span class="n">oswinsec</span><span class="p">]</span>
<a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">oswinsec</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">oswinsec</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">oswinsec</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a>
<a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a><span class="p">[</span><span class="n">osnix</span><span class="p">]</span>
<a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">osnix</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">osnix</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">osnix</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a>
<a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a><span class="p">[</span><span class="n">oswin</span><span class="p">]</span>
<a id="__codelineno-8-95" name="__codelineno-8-95" href="#__codelineno-8-95"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">oswin</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-96" name="__codelineno-8-96" href="#__codelineno-8-96"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">oswin</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-97" name="__codelineno-8-97" href="#__codelineno-8-97"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">oswin</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-98" name="__codelineno-8-98" href="#__codelineno-8-98"></a>
<a id="__codelineno-8-99" name="__codelineno-8-99" href="#__codelineno-8-99"></a><span class="p">[</span><span class="n">syslogng_fallback</span><span class="p">]</span>
<a id="__codelineno-8-100" name="__codelineno-8-100" href="#__codelineno-8-100"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">syslogng_fallback</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-101" name="__codelineno-8-101" href="#__codelineno-8-101"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">syslogng_fallback</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-102" name="__codelineno-8-102" href="#__codelineno-8-102"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">syslogng_fallback</span><span class="o">/</span><span class="n">thaweddb</span>
<a id="__codelineno-8-103" name="__codelineno-8-103" href="#__codelineno-8-103"></a>
<a id="__codelineno-8-104" name="__codelineno-8-104" href="#__codelineno-8-104"></a><span class="p">[</span><span class="n">_metrics</span><span class="p">]</span>
<a id="__codelineno-8-105" name="__codelineno-8-105" href="#__codelineno-8-105"></a><span class="n">datatype</span><span class="o">=</span><span class="n">metric</span>
<a id="__codelineno-8-106" name="__codelineno-8-106" href="#__codelineno-8-106"></a><span class="n">homePath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">_metrics</span><span class="o">/</span><span class="n">db</span>
<a id="__codelineno-8-107" name="__codelineno-8-107" href="#__codelineno-8-107"></a><span class="n">coldPath</span>   <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">_metrics</span><span class="o">/</span><span class="n">colddb</span>
<a id="__codelineno-8-108" name="__codelineno-8-108" href="#__codelineno-8-108"></a><span class="n">thawedPath</span> <span class="o">=</span> <span class="err">$</span><span class="n">SPLUNK_DB</span><span class="o">/</span><span class="n">_metrics</span><span class="o">/</span><span class="n">thaweddb</span>
</code></pre></div>
<p>Save indexes.conf to <code>/opt/splunk/etc/system/local</code> </p>
<p>Note: execute this command as root or your standard user (not <code>splunk</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">indexes</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<p>Change into <code>/opt/splunk/bin</code> and restart Splunk Enterprise as the <code>splunk</code> user.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>./splunk<span class="w"> </span>restart
</code></pre></div>
<p>Note: do not edit <code>/opt/splunk/etc/system/default/indexes.conf</code>
This step will create the following default indexes that are used by SC4S:</p>
<ul>
<li><code>email</code></li>
<li><code>epav</code></li>
<li><code>fireeye</code></li>
<li><code>gitops</code></li>
<li><code>infraops</code></li>
<li><code>netauth</code></li>
<li><code>netdlp</code></li>
<li><code>netdns</code></li>
<li><code>netfw</code></li>
<li><code>netids</code></li>
<li><code>netops</code></li>
<li><code>netwaf</code></li>
<li><code>netproxy</code></li>
<li><code>netipam</code></li>
<li><code>oswinsec</code></li>
<li><code>osnix</code></li>
<li><code>_metrics</code> (Optional opt-in for SC4S operational metrics; ensure this is created as a metrics index)</li>
</ul>
<p>Verify that the SC4S default indexes are created on web UI (Settings &gt; Indexes).</p>
<h3 id="create-a-http-event-collector-hec-token-for-sc4s">Create a HTTP Event Collector (HEC) token for SC4S</h3>
<p>On Splunk Web UI, go to Settings &gt; Data Inputs &gt; HTTP Event Collector &gt; Global Settings</p>
<p>Select Enabled for All Tokens</p>
<p>Set Default Index as main</p>
<p>Uncheck Enable SSL </p>
<p>Leave HTTP Port Number as 8088</p>
<p>Save</p>
<p><a class="glightbox" href="image.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image.png" /></a></p>
<p>Click New Token. Name your token and click Next.</p>
<p><a class="glightbox" href="image%201.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%201.png" /></a></p>
<p>Leave Source type as Automatic. Click add all for Allowed Indexes. Select main for Default Index.</p>
<p>Click Review and Submit.</p>
<p><a class="glightbox" href="image%202.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%202.png" /></a></p>
<p>Copy your Token Value and save it on a notepad (we will need this later)</p>
<p>You can also find your token value on Settings &gt; Data Inputs &gt; HTTP Event Collector</p>
<p><a class="glightbox" href="image%203.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%203.png" /></a></p>
<p><a class="glightbox" href="image%204.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%204.png" /></a></p>
<h3 id="configure-linux-for-sc4s">Configure Linux for SC4S</h3>
<p>Set the host OS kernel to match the default receiver buffer of SC4S, which is set to 16MB.</p>
<p>Add the following to <code>/etc/sysctl.conf</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">rmem_default</span> <span class="o">=</span> <span class="mi">17039360</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">net</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">rmem_max</span> <span class="o">=</span> <span class="mi">17039360</span>
</code></pre></div>
<p>Apply to the kernel by running the command  <code>sysctl -p</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">sudo</span> <span class="n">sysctl</span> <span class="o">-</span><span class="n">p</span>
</code></pre></div>
<p>Ensure the kernel is not dropping packets (optional)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">netstat</span> <span class="o">-</span><span class="n">su</span> <span class="o">|</span> <span class="n">grep</span> <span class="s2">&quot;receive errors&quot;</span> 
</code></pre></div>
<p>For Ubuntu, download net-tools on Ubuntu VM with internet connection. Transfer it over to Ubuntu VM without internet connection and install net-tools (optional)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">#On Ubuntu VM with internet connection</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="n">mkdir</span> <span class="n">net</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">offline</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">cd</span> <span class="n">net</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">offline</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="mi">755</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">cyber</span><span class="o">/</span><span class="n">net</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">offline</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">download</span> <span class="n">net</span><span class="o">-</span><span class="n">tools</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">#On Ubuntu VM without internet connection</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">cd</span> <span class="n">net</span><span class="o">-</span><span class="n">tools</span><span class="o">-</span><span class="n">offline</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">net</span><span class="o">-</span><span class="n">tools_1</span><span class="mf">.60</span><span class="o">+</span><span class="n">git20181103</span><span class="mf">.0</span><span class="n">eebece</span><span class="o">-</span><span class="mi">1</span><span class="n">ubuntu5_amd64</span><span class="o">.</span><span class="n">deb</span>
</code></pre></div>
<h3 id="install-podman-offline-on-ubuntu">Install Podman offline on Ubuntu</h3>
<p>By default, Podman is installed on CentOS Stream 9 but it is not installed on Ubuntu. </p>
<p>On a Ubuntu machine with internet connection:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nx">mkdir</span><span class="w"> </span><span class="nx">podman</span><span class="o">-</span><span class="nx">offline</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nx">cd</span><span class="w"> </span><span class="nx">podman</span><span class="o">-</span><span class="nx">offline</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">chmod</span><span class="w"> </span><span class="o">-</span><span class="nx">R</span><span class="w"> </span><span class="mf">755</span><span class="w"> </span><span class="o">/</span><span class="nx">home</span><span class="o">/</span><span class="nx">cyber</span><span class="o">/</span><span class="nx">podman</span><span class="o">-</span><span class="nx">offline</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">apt</span><span class="o">-</span><span class="nx">get</span><span class="w"> </span><span class="nx">install</span><span class="w"> </span><span class="o">--</span><span class="nx">download</span><span class="o">-</span><span class="nx">only</span><span class="w"> </span><span class="nx">podman</span><span class="w"> </span><span class="o">-</span><span class="nx">o</span><span class="w"> </span><span class="nx">Dir</span><span class="o">::</span><span class="nx">Cache</span><span class="o">=</span><span class="err">/home/cyber/podman-offline</span>
</code></pre></div>
<p>If you get permission denied error, run the <code>sudo apt-get install --download-only</code> command again.</p>
<p>Transfer <code>podman-offline</code> to the Ubuntu host without internet connection.</p>
<p>To install Podman (note archives directory should have been automatically created)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nx">cd</span><span class="w"> </span><span class="nx">podman</span><span class="o">-</span><span class="nx">offline</span><span class="o">/</span><span class="nx">archives</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nx">sudo</span><span class="w"> </span><span class="nx">dpkg</span><span class="w"> </span><span class="o">-</span><span class="nx">i</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="nx">deb</span>
</code></pre></div>
<h3 id="install-sc4s-container-while-offline">Install SC4S container while offline</h3>
<p>You can stage SC4S by downloading the image so that it can be loaded on a host machine, for example on an airgapped system, without internet connectivity.</p>
<p>Download the latest container image <code>oci_container.tgz</code> from <a href="https://github.com/splunk/splunk-connect-for-syslog/releases">SC4S GitHub</a> page.</p>
<p>Transfer the container image to your host machine.</p>
<p>Execute the following command using Podman.</p>
<p>Make a note of the container ID for the resulting load</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="n">sudo</span> <span class="n">podman</span> <span class="n">load</span> <span class="o">&lt;</span> <span class="n">oci_container</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1">#Example output</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">Loaded</span> <span class="n">image</span><span class="p">:</span> <span class="n">ghcr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="n">splunk</span><span class="o">-</span><span class="n">connect</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">syslog</span><span class="o">/</span><span class="n">container3</span><span class="p">:</span><span class="mf">3.30.1</span>
</code></pre></div>
<p>Use the container ID to create a local label: </p>
<p><code>podman tag &lt;container ID&gt; sc4slocal:latest</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">sudo</span> <span class="n">podman</span> <span class="n">tag</span> <span class="n">ghcr</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="n">splunk</span><span class="o">-</span><span class="n">connect</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="n">syslog</span><span class="o">/</span><span class="n">container3</span><span class="p">:</span><span class="mf">3.30.1</span> <span class="n">sc4slocal</span><span class="p">:</span><span class="n">latest</span>
</code></pre></div>
<p>Create the systemd unit file <code>/lib/systemd/system/sc4s.service</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">sc4s</span><span class="o">.</span><span class="n">service</span>
</code></pre></div>
<p>Copy and paste the following - note that this is the edited version of SC4S sample unit file for Podman</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">Description</span><span class="o">=</span><span class="n">SC4S</span> <span class="n">Container</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">Wants</span><span class="o">=</span><span class="n">NetworkManager</span><span class="o">.</span><span class="n">service</span> <span class="n">network</span><span class="o">-</span><span class="n">online</span><span class="o">.</span><span class="n">target</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="n">After</span><span class="o">=</span><span class="n">NetworkManager</span><span class="o">.</span><span class="n">service</span> <span class="n">network</span><span class="o">-</span><span class="n">online</span><span class="o">.</span><span class="n">target</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="c1"># Select the locally loaded image</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="n">Environment</span><span class="o">=</span><span class="s2">&quot;SC4S_IMAGE=sc4slocal:latest&quot;</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a><span class="c1"># Required mount point for syslog-ng persist data (including disk buffer)</span>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="n">Environment</span><span class="o">=</span><span class="s2">&quot;SC4S_PERSIST_MOUNT=splunk-sc4s-var:/var/lib/syslog-ng&quot;</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="c1"># Optional mount point for local overrides and configurations; see notes in docs</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a><span class="n">Environment</span><span class="o">=</span><span class="s2">&quot;SC4S_LOCAL_MOUNT=/opt/sc4s/local:/etc/syslog-ng/conf.d/local:z&quot;</span>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="c1"># Optional mount point for local disk archive (EWMM output) files</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a><span class="n">Environment</span><span class="o">=</span><span class="s2">&quot;SC4S_ARCHIVE_MOUNT=/opt/sc4s/archive:/var/lib/syslog-ng/archive:z&quot;</span>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="c1"># Map location of TLS custom TLS</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a><span class="n">Environment</span><span class="o">=</span><span class="s2">&quot;SC4S_TLS_MOUNT=/opt/sc4s/tls:/etc/syslog-ng/tls:z&quot;</span>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="n">TimeoutStartSec</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a><span class="c1">#ExecStartPre=/usr/bin/podman pull $SC4S_IMAGE</span>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="c1"># Note: /usr/bin/bash will not be valid path for all OS</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a><span class="c1"># when startup fails on running bash check if the path is correct</span>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="n">ExecStartPre</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;/usr/bin/systemctl set-environment SC4SHOST=$(hostname -s)&quot;</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a><span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">podman</span> <span class="n">run</span> \
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a>        <span class="o">-</span><span class="n">e</span> <span class="s2">&quot;SC4S_CONTAINER_HOST=$</span><span class="si">{SC4SHOST}</span><span class="s2">&quot;</span> \
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a>        <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$SC4S_PERSIST_MOUNT&quot;</span> \
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>        <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$SC4S_LOCAL_MOUNT&quot;</span> \
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a>        <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$SC4S_ARCHIVE_MOUNT&quot;</span> \
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a>        <span class="o">-</span><span class="n">v</span> <span class="s2">&quot;$SC4S_TLS_MOUNT&quot;</span> \
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>        <span class="o">--</span><span class="n">env</span><span class="o">-</span><span class="n">file</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">sc4s</span><span class="o">/</span><span class="n">env_file</span> \
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a>        <span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;/healthcheck.sh&quot;</span> \
<a id="__codelineno-23-41" name="__codelineno-23-41" href="#__codelineno-23-41"></a>        <span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="n">s</span> <span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">retries</span><span class="o">=</span><span class="mi">6</span> <span class="o">--</span><span class="n">health</span><span class="o">-</span><span class="n">timeout</span><span class="o">=</span><span class="mi">6</span><span class="n">s</span> \
<a id="__codelineno-23-42" name="__codelineno-23-42" href="#__codelineno-23-42"></a>        <span class="o">--</span><span class="n">network</span> <span class="n">host</span> \
<a id="__codelineno-23-43" name="__codelineno-23-43" href="#__codelineno-23-43"></a>        <span class="o">--</span><span class="n">name</span> <span class="n">SC4S</span> \
<a id="__codelineno-23-44" name="__codelineno-23-44" href="#__codelineno-23-44"></a>        <span class="o">--</span><span class="n">rm</span> <span class="err">$</span><span class="n">SC4S_IMAGE</span>
<a id="__codelineno-23-45" name="__codelineno-23-45" href="#__codelineno-23-45"></a>
<a id="__codelineno-23-46" name="__codelineno-23-46" href="#__codelineno-23-46"></a><span class="n">Restart</span><span class="o">=</span><span class="n">on</span><span class="o">-</span><span class="n">abnormal</span>
</code></pre></div>
<h3 id="configure-ipv4-forwarding">Configure IPv4 forwarding</h3>
<p>IPv4 forwarding is not enabled by default. IPv4 forwarding must be enabled for container networking.</p>
<p>To check that IPv4 forwarding is enabled: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">sudo</span> <span class="n">sysctl</span> <span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">ip_forward</span>
</code></pre></div>
<p>To enable IPv4 forwarding: </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="n">sudo</span> <span class="n">sysctl</span> <span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">ip_forward</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
<p>To ensure your changes persist upon reboot:</p>
<ul>
<li>Define sysctl settings through files in <code>/usr/lib/sysctl.d/</code>and <code>/etc/sysctl.d/</code>.</li>
<li>To override only specific settings, either add a file with a lexically later name in <code>/etc/sysctl.d/</code> and put following setting there or find this specific setting in one of the existing configuration files and set the value to <code>1</code>.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">cd</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">d</span><span class="o">/</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="n">sudo</span> <span class="n">nano</span> <span class="mi">100</span><span class="o">-</span><span class="n">custom</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="n">net</span><span class="o">.</span><span class="n">ipv4</span><span class="o">.</span><span class="n">ip_forward</span><span class="o">=</span><span class="mi">1</span>
</code></pre></div>
<ul>
<li>Repeat the same steps for <code>/etc/sysctl.d/</code>.</li>
<li>For example, in the <code>/usr/lib/sysctl.d/</code> directory, there are few config files. The naming convention is XX-name.conf with XX being a number. Create a custom.conf with a higher number e.g. <code>100-custom.conf</code> with the content <code>net.ipv4.ip_forward=1</code> .</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">cyber</span><span class="nd">@SplunkEnt</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">sysctl</span><span class="o">.</span><span class="n">d</span><span class="err">$</span> <span class="n">ls</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="mi">100</span><span class="o">-</span><span class="n">custom</span><span class="o">.</span><span class="n">conf</span>  <span class="mi">50</span><span class="o">-</span><span class="n">bubblewrap</span><span class="o">.</span><span class="n">conf</span>  <span class="mi">50</span><span class="o">-</span><span class="n">pid</span><span class="o">-</span><span class="nb">max</span><span class="o">.</span><span class="n">conf</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="mi">30</span><span class="o">-</span><span class="n">tracker</span><span class="o">.</span><span class="n">conf</span>  <span class="mi">50</span><span class="o">-</span><span class="n">default</span><span class="o">.</span><span class="n">conf</span>     <span class="mi">99</span><span class="o">-</span><span class="n">protect</span><span class="o">-</span><span class="n">links</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<p>Create a Podman/Docker local volume that will contain the disk buffer files and other SC4S state files:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">sudo</span> <span class="n">podman</span> <span class="n">volume</span> <span class="n">create</span> <span class="n">splunk</span><span class="o">-</span><span class="n">sc4s</span><span class="o">-</span><span class="n">var</span>
</code></pre></div>
<p>Create directories to be used as a mount point for local overrides and configurations:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">sc4s</span><span class="o">/</span><span class="n">local</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">sc4s</span><span class="o">/</span><span class="n">archive</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">sudo</span> <span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">sc4s</span><span class="o">/</span><span class="n">tls</span>
</code></pre></div>
<p>Create the environment file <code>/opt/sc4s/env_file</code> and replace the HEC_URL and HEC_TOKEN as necessary:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">sudo</span> <span class="n">nano</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">sc4s</span><span class="o">/</span><span class="n">env_file</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">SC4S_DEST_SPLUNK_HEC_DEFAULT_URL</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">your</span><span class="o">.</span><span class="n">splunk</span><span class="o">.</span><span class="n">instance</span><span class="p">:</span><span class="mi">8088</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">SC4S_DEST_SPLUNK_HEC_DEFAULT_TOKEN</span><span class="o">=</span><span class="n">xxxxxxxx</span><span class="o">-</span><span class="n">xxxx</span><span class="o">-</span><span class="n">xxxx</span><span class="o">-</span><span class="n">xxxx</span><span class="o">-</span><span class="n">xxxxxxxxxxxx</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="c1">#Uncomment the following line if using untrusted SSL certificates</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">SC4S_DEST_SPLUNK_HEC_DEFAULT_TLS_VERIFY</span><span class="o">=</span><span class="n">no</span>
</code></pre></div>
<p>For example:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="n">SC4S_DEST_SPLUNK_HEC_DEFAULT_URL</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">10.0.0.120</span><span class="p">:</span><span class="mi">8088</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">SC4S_DEST_SPLUNK_HEC_DEFAULT_TOKEN</span><span class="o">=</span><span class="mi">8</span><span class="n">be8e3f3</span><span class="o">-</span><span class="mi">49</span><span class="n">fc</span><span class="o">-</span><span class="mi">4158</span><span class="o">-</span><span class="n">a20c</span><span class="o">-</span><span class="n">bcf82be93dda</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="c1">#Uncomment the following line if using untrusted SSL certificates</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="n">SC4S_DEST_SPLUNK_HEC_DEFAULT_TLS_VERIFY</span><span class="o">=</span><span class="n">no</span>
</code></pre></div>
<p>Configure SC4S for systemd and start SC4S. Verify sc4s is active and running (exit with <code>q</code>)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">daemon</span><span class="o">-</span><span class="n">reload</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">sc4s</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">sc4s</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">status</span> <span class="n">sc4s</span>
</code></pre></div>
<p>Check podman/docker logs for errors:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="n">sudo</span> <span class="n">podman</span> <span class="n">logs</span> <span class="n">SC4S</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">#Example Output</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">SC4S_ENV_CHECK_HEC</span><span class="p">:</span> <span class="n">Splunk</span> <span class="n">HEC</span> <span class="n">connection</span> <span class="n">test</span> <span class="n">successful</span> <span class="n">to</span> <span class="n">index</span><span class="o">=</span><span class="n">main</span> <span class="k">for</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">sc4s</span><span class="p">:</span><span class="n">fallback</span><span class="o">...</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">SC4S_ENV_CHECK_HEC</span><span class="p">:</span> <span class="n">Splunk</span> <span class="n">HEC</span> <span class="n">connection</span> <span class="n">test</span> <span class="n">successful</span> <span class="n">to</span> <span class="n">index</span><span class="o">=</span><span class="n">main</span> <span class="k">for</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">sc4s</span><span class="p">:</span><span class="n">events</span><span class="o">...</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="n">syslog</span><span class="o">-</span><span class="n">ng</span> <span class="n">checking</span> <span class="n">config</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="n">sc4s</span> <span class="n">version</span><span class="o">=</span><span class="mf">3.30.0</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="n">starting</span> <span class="n">goss</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="n">starting</span> <span class="n">syslog</span><span class="o">-</span><span class="n">ng</span>
</code></pre></div>
<p>Search on Splunk for successful installation of SC4S:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="n">index</span><span class="o">=*</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">sc4s</span><span class="p">:</span><span class="n">events</span> <span class="s2">&quot;starting up&quot;</span>
</code></pre></div>
<p><a class="glightbox" href="image%205.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%205.png" /></a></p>
<p>Send sample data to default udp port 514 of SC4S host: <code>echo “Hello SC4S” &gt; /dev/udp/&lt;SC4S_ip&gt;/514</code> </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">echo</span> <span class="err">“</span><span class="n">Hello</span> <span class="n">SC4S</span><span class="err">”</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">udp</span><span class="o">/</span><span class="mf">10.0.0.120</span><span class="o">/</span><span class="mi">514</span>
</code></pre></div>
<p>Search for <code>index=* "Hello SC4S"</code></p>
<p><a class="glightbox" href="image%206.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%206.png" /></a></p>
<p>Verify that SC4S is receiving Fortigate logs</p>
<p><a class="glightbox" href="image%207.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%207.png" /></a></p>
<h2 id="ingesting-fortigate-logs-through-fortigate-app-option-2">Ingesting FortiGate Logs through FortiGate App (Option 2)</h2>
<p>If SC4S does not work for your environment, another option to ingest FortiGate logs on Splunk is through FortiGate App.</p>
<p>Install from file on Splunk web UI: Manage Apps-&gt;Install from file-&gt;Upload the .tgz file which is downloaded from <a href="https://splunkbase.splunk.com/app/2846">https://splunkbase.splunk.com/app/2846</a> -&gt;check the upgrade box-&gt; click restart splunk service.</p>
<p><a class="glightbox" href="image%208.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%208.png" /></a></p>
<h3 id="add-data-input-on-splunk-server">Add data input on Splunk server:</h3>
<p>Note: From version 1.2, the Splunk TA(Add-on) for fortigate no longer match wildcard source or sourcetype to extract fortigate log data, a default sourcetype fortigate_log is specified in default/props.conf instead, please follow the instruction below to configure your input and props.conf for the App and TA(Add-on).</p>
<p>Navigate to Settings-&gt;Data Input-&gt;UDP on Splunk Web UI. Click New Local UDP.</p>
<p>For Port, enter <code>514</code> and leave other parameters as is.</p>
<p><a class="glightbox" href="image%209.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%209.png" /></a></p>
<p>For Source type, select <code>fortigate_log</code> (search for <code>fortigate_log</code> in the search bar)</p>
<p><a class="glightbox" href="image%2010.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2010.png" /></a></p>
<p>Click Review and Submit. If you get the error <code>UDP 514 is not available</code> use other UDP port (e.g. <code>5514</code>). Restart Splunk service for the change to take effect.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">splunk</span> <span class="n">restart</span>
</code></pre></div>
<p>Configure FortiGate to send syslog by following the steps below.</p>
<p>Navigate to Search &amp; Reporting on Splunk web UI. </p>
<p>Search for <code>fortigate</code> and verify that FortiGate logs are being ingested.  </p>
<p><a class="glightbox" href="image%2011.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2011.png" /></a></p>
<h2 id="configure-fortigate">Configure FortiGate</h2>
<p>Configure Port 1 as WAN interface </p>
<p>Configure Port 2 as LAN interface. </p>
<p>Configure DHCP to automatically assign IP addresses to clients connecting to LAN</p>
<p><a class="glightbox" href="image%2012.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2012.png" /></a></p>
<p>Create a new firewall policy to allow LAN to WAN</p>
<p>To simulate an air-gapped environment without internet access, disable the policy for now. </p>
<p><a class="glightbox" href="image%2013.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2013.png" /></a></p>
<p><a class="glightbox" href="image%2014.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2014.png" /></a></p>
<h2 id="configure-fortigate-to-send-syslog">Configure FortiGate to send syslog</h2>
<p>Refer to the admin manual for specific details of configuration to send Reliable syslog using RFC 3195 format, a typical logging configuration will include the following features.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">config</span> <span class="n">log</span> <span class="n">syslogd</span> <span class="n">setting</span> 
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nb">set</span> <span class="n">status</span> <span class="n">enable</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="nb">set</span> <span class="n">server</span> <span class="p">(</span><span class="n">syslog</span><span class="o">-</span><span class="n">ng</span> <span class="n">ip</span><span class="p">)</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="nb">set</span> <span class="n">source</span><span class="o">-</span><span class="n">ip</span> <span class="p">(</span><span class="n">fortigate</span> <span class="n">ip</span><span class="p">)</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="c1">#set port (port number) (default port is 514)</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="c1">#Verify settings by running &quot;show&quot;</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a><span class="n">end</span> 
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="n">config</span> <span class="n">log</span> <span class="n">memory</span> <span class="nb">filter</span>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="nb">set</span> <span class="n">forward</span><span class="o">-</span><span class="n">traffic</span> <span class="n">enable</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="nb">set</span> <span class="n">local</span><span class="o">-</span><span class="n">traffic</span> <span class="n">enable</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="nb">set</span> <span class="n">sniffer</span><span class="o">-</span><span class="n">traffic</span> <span class="n">disable</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="nb">set</span> <span class="n">anomaly</span> <span class="n">enable</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="nb">set</span> <span class="n">voip</span> <span class="n">disable</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="nb">set</span> <span class="n">multicast</span><span class="o">-</span><span class="n">traffic</span> <span class="n">enable</span>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="c1">#Verify settings by running &quot;show full-configuration&quot;</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="n">end</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="n">config</span> <span class="n">system</span> <span class="k">global</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="nb">set</span> <span class="n">cli</span><span class="o">-</span><span class="n">audit</span><span class="o">-</span><span class="n">log</span> <span class="n">enable</span>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="c1">#Verify settings by running &quot;show&quot;</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="c1">#Make sure timezone is correct e.g. &quot;Pacific/Auckland&quot;</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="n">end</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="n">config</span> <span class="n">log</span> <span class="n">setting</span>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="nb">set</span> <span class="n">neighbor</span><span class="o">-</span><span class="n">event</span> <span class="n">enable</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="n">end</span>
</code></pre></div>
<h2 id="configure-cisco-isr-to-send-syslog">Configure Cisco ISR to send syslog</h2>
<p>Note: this step needs to be verified with a Cisco device in a testing environment. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">show</span> <span class="n">clock</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">ntp</span> <span class="n">server</span> <span class="p">(</span><span class="n">IP</span> <span class="n">address</span> <span class="n">of</span> <span class="n">Fortigate</span><span class="p">)</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">conf</span> <span class="n">f</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="n">logging</span> <span class="n">on</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="n">logging</span> <span class="p">(</span><span class="n">IP</span> <span class="n">address</span> <span class="n">of</span> <span class="n">Syslog</span> <span class="n">server</span><span class="p">)</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="n">logging</span> <span class="n">trap</span> <span class="mi">6</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="c1">#Use &quot;?&quot; to see what options are available</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="n">exit</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="c1">#Turn on interface by no shut</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="n">show</span> <span class="n">logging</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="c1">#port 514 udp by default</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a><span class="n">sh</span> <span class="n">run</span> <span class="o">|</span> <span class="n">inc</span> <span class="n">logging</span>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="c1">#we can set multiple syslog servers</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="c1">#Set IP address for int vlan 1</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a><span class="c1">#Test ping to syslog server</span>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="n">conf</span> <span class="n">t</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="n">service</span> <span class="n">sequence</span><span class="o">-</span><span class="n">numbers</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a><span class="c1">#Assign sequence-numbers to syslogs in order that events occurred on</span>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="n">conf</span> <span class="n">t</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="n">line</span> <span class="n">console</span> <span class="mi">0</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a><span class="n">logging</span> <span class="n">synchronous</span>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="c1">#Force Syslog messages to be displayed once configuration has been completed.</span>
</code></pre></div>
<p><em>Note: in this scenario, we are sending syslogs from network devices to a containerised syslog-ng server using HTTP/HTTPS. This is Splunk team’s recommended method when using Splunk products. Alternatively, you can send syslogs from network devices to a rsyslog server and rotate the logs. This method is used by other SIEMs like Wazuh. For more details, refer to the Wazuh documentation.</em>  </p>
<h2 id="splunk-universal-forwarder">Splunk Universal Forwarder</h2>
<h2 id="install-sysmon-on-windows">Install Sysmon on Windows</h2>
<p>Download <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon">Sysmon</a> and <a href="https://github.com/olafhartong/sysmon-modular/blob/master/sysmonconfig.xml">sysmonconfig.xml</a></p>
<p>Extract Sysmon.zip and move sysmonconfig.xml into the Sysmon folder where Sysmon.exe is located.</p>
<p>Run PowerShell as Administrator and change directory to path where extracted Sysmon is located</p>
<p>Move sysmonconfig.xml to the same directory</p>
<p>Install Symon by running <code>.\Sysmon64.exe -accepteula -i sysmonconfig.xml</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ownloads<span class="se">\S</span>ysmon<span class="se">\S</span>ysmon&gt;<span class="w"> </span>ls
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">    </span>Directory:<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ownloads<span class="se">\S</span>ysmon<span class="se">\S</span>ysmon
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>Mode<span class="w">                </span>LastWriteTime<span class="w">         </span>Length<span class="w"> </span>Name
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>----<span class="w">                </span>-------------<span class="w">         </span>------<span class="w"> </span>----
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>------<span class="w">        </span><span class="m">7</span>/23/2024<span class="w">   </span><span class="m">2</span>:08<span class="w"> </span>PM<span class="w">           </span><span class="m">7490</span><span class="w"> </span>Eula.txt
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>------<span class="w">        </span><span class="m">7</span>/23/2024<span class="w">   </span><span class="m">2</span>:08<span class="w"> </span>PM<span class="w">        </span><span class="m">8480560</span><span class="w"> </span>Sysmon.exe
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>------<span class="w">        </span><span class="m">7</span>/23/2024<span class="w">   </span><span class="m">2</span>:08<span class="w"> </span>PM<span class="w">        </span><span class="m">4563248</span><span class="w"> </span>Sysmon64.exe
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a>------<span class="w">        </span><span class="m">7</span>/23/2024<span class="w">   </span><span class="m">2</span>:08<span class="w"> </span>PM<span class="w">        </span><span class="m">4993440</span><span class="w"> </span>Sysmon64a.exe
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>-a----<span class="w">        </span><span class="m">8</span>/26/2024<span class="w">   </span><span class="m">7</span>:31<span class="w"> </span>PM<span class="w">         </span><span class="m">123257</span><span class="w"> </span>sysmonconfig.xml
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a>PS<span class="w"> </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ownloads<span class="se">\S</span>ysmon<span class="se">\S</span>ysmon&gt;<span class="w"> </span>.<span class="se">\S</span>ysmon64.exe<span class="w"> </span>-accepteula<span class="w"> </span>-i<span class="w"> </span>.<span class="se">\s</span>ysmonconfig.xml
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a>System<span class="w"> </span>Monitor<span class="w"> </span>v15.15<span class="w"> </span>-<span class="w"> </span>System<span class="w"> </span>activity<span class="w"> </span>monitor
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a>By<span class="w"> </span>Mark<span class="w"> </span>Russinovich<span class="w"> </span>and<span class="w"> </span>Thomas<span class="w"> </span>Garnier
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">2014</span>-2024<span class="w"> </span>Microsoft<span class="w"> </span>Corporation
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a>Using<span class="w"> </span>libxml2.<span class="w"> </span>libxml2<span class="w"> </span>is<span class="w"> </span>Copyright<span class="w"> </span><span class="o">(</span>C<span class="o">)</span><span class="w"> </span><span class="m">1998</span>-2012<span class="w"> </span>Daniel<span class="w"> </span>Veillard.<span class="w"> </span>All<span class="w"> </span>Rights<span class="w"> </span>Reserved.
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a>Sysinternals<span class="w"> </span>-<span class="w"> </span>www.sysinternals.com
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a>Loading<span class="w"> </span>configuration<span class="w"> </span>file<span class="w"> </span>with<span class="w"> </span>schema<span class="w"> </span>version<span class="w"> </span><span class="m">4</span>.50
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a>Sysmon<span class="w"> </span>schema<span class="w"> </span>version:<span class="w"> </span><span class="m">4</span>.90
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>Configuration<span class="w"> </span>file<span class="w"> </span>validated.
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a>Sysmon64<span class="w"> </span>installed.
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a>SysmonDrv<span class="w"> </span>installed.
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a>Starting<span class="w"> </span>SysmonDrv.
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>SysmonDrv<span class="w"> </span>started.
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a>Starting<span class="w"> </span>Sysmon64..
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a>Sysmon64<span class="w"> </span>started.
</code></pre></div>
<p>Verify that Sysmon is installed by checking Services (Sysmon64) and Windows EventViewer (Applications and Services Logs &gt; Microsoft &gt; Windows &gt; Sysmon)</p>
<p><a class="glightbox" href="image%2015.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2015.png" /></a></p>
<p><a class="glightbox" href="image%2016.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2016.png" /></a></p>
<h2 id="create-a-domain-account">Create a Domain Account</h2>
<p>Note: in this lab, WS2019 host was joined to a domain called cyber.local and promoted as a domain controller. This step is applicable to a domain-joined environment. </p>
<p>Create a domain user called <code>splunk</code> and assign it as a member of <code>Event Log Readers Group</code>.</p>
<p>This account will be used to run Splunk Forwarder. </p>
<ul>
<li>Go to Active Directory Users and Computers &gt; domain &gt; Users</li>
<li>Right Users &gt; New &gt; User</li>
<li>Right-click splunk user &gt; Properties &gt; Member of &gt; Add &gt; Type Event Log Readers and click Check Names &gt; OK &gt; Apply and OK</li>
</ul>
<p><a class="glightbox" href="image%2017.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2017.png" /></a></p>
<h2 id="configure-rdp-for-domain-user-splunk-optional">Configure RDP for domain user splunk (optional)</h2>
<p>Note: in this lab, RDP configuration was required for the <code>splunk</code> user to login to WS2019 host. This step is optional. </p>
<p>If RDP needs to be configured and there is an error after configuring firewall and enabling RDP, edit group policy.</p>
<p>Open Local Group Policy Editor by clicking Run &gt; type <code>gpedit.msc</code></p>
<p>In the Local Group Policy Editor, navigate to Windows Settings &gt; Security Settings &gt; Local Policies &gt; User Rights Assignment &gt; Allow log on through Remote Desktop Services</p>
<p>Add user splunk</p>
<p><a class="glightbox" href="image%2018.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2018.png" /></a></p>
<p>In the Local Group Policy Editor, navigate to Computer configuration &gt; Windows Settings &gt; Administrative Templates &gt; Windows Components &gt; Remote Desktop Services &gt; Remote Desktop Session Host &gt; Connections &gt; Allow users to connect remotely by using Remote Desktop Services &gt;Enabled </p>
<p><a class="glightbox" href="image%2019.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2019.png" /></a></p>
<p>Navigate to Remote Desktop Session Host &gt; Security &gt; Require user authentication for remote connections by using Network Level Authentication &gt; Enabled</p>
<p><a class="glightbox" href="image%2020.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2020.png" /></a></p>
<p>In Server Manager, go to Local Server. Make sure Remote Desktop is Enabled. Add user <code>splunk</code>.</p>
<p><a class="glightbox" href="image%2021.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2021.png" /></a></p>
<p>Enable inbound firewall rules related to Remote Desktop</p>
<p><a class="glightbox" href="image%2022.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2022.png" /></a></p>
<p>RDP into WS2019 host as the splunk user from another internal host.</p>
<h2 id="configure-splunk-universal-forwarder-on-windows">Configure Splunk Universal Forwarder on Windows</h2>
<p><a href="https://www.splunk.com/en_us/download/universal-forwarder.html">Download</a> and transfer the Splunk Universal Forwarder msi for Windows.</p>
<p>Run Universal Forwarder msi, accept license, select on-premise Splunk Enterprise instance, and click Customize Options</p>
<p><a class="glightbox" href="image%2023.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2023.png" /></a></p>
<p>Leave Path as default and click Next</p>
<p><a class="glightbox" href="image%2024.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2024.png" /></a></p>
<p>Leave Certificate Password empty and click Next</p>
<p><a class="glightbox" href="image%2025.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2025.png" /></a></p>
<p>Select Domain Account</p>
<p>Note: using Virtual Account is recommended but you may encounter errors with the Virtual Account. Test your install with the Virtual Account before selecting Domain Account. </p>
<p>Refer to Annex 1. </p>
<p><a class="glightbox" href="image%2026.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2026.png" /></a></p>
<p>Specify DOMAIN\splunk and password for the account</p>
<p><a class="glightbox" href="image%2027.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2027.png" /></a></p>
<p>Leave permissions as default</p>
<p><a class="glightbox" href="image%2028.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2028.png" /></a></p>
<p>Leave everything unchecked and click Next</p>
<p><a class="glightbox" href="image%2029.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2029.png" /></a></p>
<p>Create credentials for the administrator account.</p>
<p>Note: in this lab, the administrator account for Splunk Universal Forwarder is also configured as splunk but this is different to the domain account splunk that has been created earlier.</p>
<p><a class="glightbox" href="image%2030.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2030.png" /></a></p>
<p>Enter IP address of your Deployment Server (Splunk server) and port 8089. Note the IP address in the screenshot points to the previous version of lab where Splunk server's IP address was 10.0.0.20.</p>
<p><a class="glightbox" href="image%2031.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2031.png" /></a></p>
<p>Enter IP address of your Receiving Indexer (Splunk server) and port 9997</p>
<p><a class="glightbox" href="image%2032.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2032.png" /></a></p>
<p>Click Install. Click Finish after install is complete.</p>
<p><a class="glightbox" href="image%2033.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2033.png" /></a></p>
<h2 id="create-a-new-outbound-firewall-rule">Create a new outbound Firewall rule</h2>
<p>Navigate to Windows Defender Firewall with Advanced Security </p>
<p>Right-click on Outbound Rules and select New Rule</p>
<p>Select Program as Rule Type</p>
<p><a class="glightbox" href="image%2034.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2034.png" /></a></p>
<p>For program path, browse to C:\Program Files\SplunkUniversalForwarder\bin\splund.exe</p>
<p><a class="glightbox" href="image%2035.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2035.png" /></a></p>
<p>Select Allow the Connection</p>
<p><a class="glightbox" href="image%2036.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2036.png" /></a></p>
<p>Check all boxes for Domain, Private and Public</p>
<p><a class="glightbox" href="image%2037.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2037.png" /></a></p>
<p>Name the rule as Splunk outbound</p>
<p><a class="glightbox" href="image%2038.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2038.png" /></a></p>
<p>Verify that yours Windows host is connected to the Deployment Server.</p>
<p>On the Splunk Enterprise web UI (CentOS), go to Settings &gt; Forwarder Management &gt; Clients</p>
<p>You should be able to see your Windows host</p>
<p><a class="glightbox" href="image%2039.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2039.png" /></a></p>
<h2 id="install-splunk-apps">Install Splunk Apps</h2>
<p>Download the following Splunk Apps (tar archive files)</p>
<ul>
<li><a href="https://splunkbase.splunk.com/app/742">Splunk Add-on for MS Windows</a></li>
<li><a href="https://splunkbase.splunk.com/app/5709">Splunk Add-on for Sysmon</a></li>
<li><a href="https://splunkbase.splunk.com/app/833">Splunk Add-on for Unix and Linux</a> (optional: applicable to Linux clients)</li>
</ul>
<p>Install the add-ons (apps) on Splunk Enterprise web UI</p>
<p>Go to Apps &gt; Manage Apps &gt; Install app from file &gt; Upload the tar archive files</p>
<p><a class="glightbox" href="image%2040.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2040.png" /></a></p>
<p><a class="glightbox" href="image%2041.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2041.png" /></a></p>
<p><a class="glightbox" href="image%2042.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2042.png" /></a></p>
<p><a class="glightbox" href="image%2043.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2043.png" /></a></p>
<p>If there is an error while uploading the file, try uploading it again. </p>
<p>If prompted to set up the apps, click set up later.</p>
<p><a class="glightbox" href="image%2044.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2044.png" /></a></p>
<p>Make sure Splunk Add-ons for Microsoft Windows and Sysmon are enabled.</p>
<p>On terminal of the host where Splunk Enterprise is installed, verify that there are <code>Splunk_TA_microsoft_sysmon</code> and <code>Splunk_TA_windows</code> in <code>/opt/splunk/etc/apps</code> directory</p>
<p>Copy the apps to <code>/opt/splunk/etc/deployment-apps</code> directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nb">cd</span><span class="w"> </span>/opt/splunk/etc/apps
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>sudo<span class="w"> </span>cp<span class="w"> </span>-r<span class="w"> </span>Splunk_TA_*<span class="w"> </span>/opt/splunk/etc/deployment-apps/
</code></pre></div>
<p>Verify that the apps are shown in the Splunk Enterprise web UI</p>
<p>Go to Settings &gt; Forwarder Management &gt; Apps</p>
<p>Search for Splunk</p>
<p><a class="glightbox" href="image%2045.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2045.png" /></a></p>
<h2 id="configure-unix-app-and-create-unix-server-class-optional">Configure Unix app and create unix server class (optional)</h2>
<p>Note: this step is applicable if you installed Splunk_TA_nix app.</p>
<p>On the same page, next to the apps, click Edit under Actions for Splunk_TA_nix.</p>
<p>Select Restart Splunkd After Installation, create New Server Class called nix,  and click Save</p>
<p><a class="glightbox" href="Untitled%203.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%203.png" /></a></p>
<p><a class="glightbox" href="Untitled%204.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%204.png" /></a></p>
<p>Add Apps</p>
<p><a class="glightbox" href="Untitled%205.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%205.png" /></a></p>
<p>Select Splunk_TA_nix and click Save</p>
<p><a class="glightbox" href="Untitled%206.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%206.png" /></a></p>
<p>Add Clients</p>
<p><a class="glightbox" href="Untitled%207.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%207.png" /></a></p>
<p>In the Include, put *, and in filter by Machine Type, add linux-x86_64</p>
<p>Click Preview</p>
<p>You should see a tick next to your Linux host and your Linux host should appear under Matched</p>
<p>Click Save</p>
<p><a class="glightbox" href="image%2046.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2046.png" /></a></p>
<p>Go to Forwarder Management and verify that your Linux host is connected to Splunk_TA_nix Apps and nix Server Class</p>
<p><a class="glightbox" href="image%2047.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2047.png" /></a></p>
<p>If the settings are not applied try reloading the deployment server </p>
<p>On the terminal of the host where Splunk Enterprise is installed, run the command</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>splunk@siem:/opt/splunk/bin#<span class="w"> </span>./splunk<span class="w"> </span>reload<span class="w"> </span>deploy-server
</code></pre></div>
<h2 id="configure-windows-and-sysmon-apps-and-create-windows-server-class">Configure Windows and Sysmon apps and create windows server class</h2>
<p>To avoid permission denied error, change ownership and adjust directory permissions for the <code>/opt/splunk/etc/deployment-apps</code> </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="n">sudo</span> <span class="n">chown</span> <span class="o">-</span><span class="n">R</span> <span class="n">splunk</span><span class="p">:</span><span class="n">splunk</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">deployment</span><span class="o">-</span><span class="n">apps</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">-</span><span class="n">R</span> <span class="mi">755</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">deployment</span><span class="o">-</span><span class="n">apps</span>
</code></pre></div>
<p>On the Forwarder Management page of the web UI, click Edit under Actions for Splunk_TA_windows</p>
<p>Select Restart Splunkd After Installation, add New Server Class called win, and click Save</p>
<p><a class="glightbox" href="Untitled%208.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%208.png" /></a></p>
<p>Click Add Apps and select Splunk_TA_windows and Splunk_TA_micorsoft_sysmon. Click Save</p>
<p><a class="glightbox" href="image%2048.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2048.png" /></a></p>
<p>Click Add Clients. Put * in Include, and filter by windows-x64.</p>
<p>Click Preview</p>
<p>Click Save</p>
<p><a class="glightbox" href="image%2049.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2049.png" /></a></p>
<p>You should see Restart Splunkd in the After installation column. </p>
<p>If only Enable App is shown, Edit each app and select Restart Splunkd.</p>
<p><a class="glightbox" href="image%2050.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2050.png" /></a></p>
<p><a class="glightbox" href="image%2051.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2051.png" /></a></p>
<p>Verify the configuration in the Forwarder Management</p>
<p><a class="glightbox" href="image%2052.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2052.png" /></a></p>
<p><a class="glightbox" href="image%2053.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2053.png" /></a></p>
<p>If the configuration is not applied, try reloading the deployment-server</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>splunk@siem:/opt/splunk/bin#<span class="w"> </span>./splunk<span class="w"> </span>reload<span class="w"> </span>deploy-server
</code></pre></div>
<p>Verify that <code>/opt/splunk/etc/system/local/serverclass.conf</code> aligns with our configuration so far</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">sudo</span> <span class="n">cat</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunk</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">serverclass</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="o">[</span>serverClass:win:app:Splunk_TA_microsoft_sysmon<span class="o">]</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="nv">restartSplunkWeb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="nv">restartSplunkd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="nv">stateOnClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>enabled
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="o">[</span>serverClass:win:app:Splunk_TA_windows<span class="o">]</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="nv">restartSplunkWeb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="nv">restartSplunkd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="nv">stateOnClient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>enabled
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="o">[</span>serverClass:win<span class="o">]</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="nv">machineTypesFilter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>windows-x64
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>whitelist.0<span class="w"> </span><span class="o">=</span><span class="w"> </span>*
</code></pre></div>
<h2 id="create-indexes">Create Indexes</h2>
<p>Create indexes on the web UI.</p>
<p>Note: your index name must match with index name in inputs.conf in each app.</p>
<p>Go to settings &gt; indexes &gt; New Index</p>
<table>
<thead>
<tr>
<th><strong>Index Name</strong></th>
<th>wineventlog</th>
<th>sysmonlog</th>
<th>unixlog (optional)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Index Data Type</strong></td>
<td>Events</td>
<td>Events</td>
<td>Events</td>
</tr>
<tr>
<td><strong>Max Size of entire Index</strong></td>
<td>1 GB (Default is 500 GB so adjust accordingly)</td>
<td>1 GB (Default is 500 GB so adjust accordingly)</td>
<td>1 GB (Default is 500 GB so adjust accordingly)</td>
</tr>
<tr>
<td><strong>Enable Reduction</strong></td>
<td>Enable (optional)</td>
<td>Enable (optional)</td>
<td>Enable (optional)</td>
</tr>
<tr>
<td><strong>Reduce tisdx files older than</strong></td>
<td>90 days</td>
<td>90 days</td>
<td>90 days</td>
</tr>
</tbody>
</table>
<p>Verify that indexes have been created and enabled</p>
<p><a class="glightbox" href="image%2054.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2054.png" /></a></p>
<p><a class="glightbox" href="Untitled%209.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Untitled" src="Untitled%209.png" /></a></p>
<p><a class="glightbox" href="image%2055.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2055.png" /></a></p>
<h2 id="edit-config-files-for-windows-app">Edit config files for Windows app</h2>
<p>On the Linux host where Splunk Enterprise is installed, change into <code>opt/splunk/etc/deployment-apps/Splunk_TA_windows/local</code> directory</p>
<p>Copy <code>app.conf</code> and <code>inputs.conf</code> from <code>/opt/splunk/etc/deployment-apps/Splunk_TA_windows/default</code> directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nb">cd</span><span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_windows/local
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_windows/default/app.conf<span class="w"> </span>.
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_windows/default/inputs.conf<span class="w"> </span>.
</code></pre></div>
<p>Make the following changes to <code>inputs.conf</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">nano</span> <span class="n">inputs</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="o">[</span>default<span class="o">]</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>wineventlog
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="c1">###### OS Logs ######</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="o">[</span>WinEventLog://Application<span class="o">]</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="nv">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="nv">start_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>oldest
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="nv">current_only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="nv">checkpointInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="nv">renderXml</span><span class="o">=</span><span class="nb">false</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="o">[</span>WinEventLog://Security<span class="o">]</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="nv">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-52-14" name="__codelineno-52-14" href="#__codelineno-52-14"></a><span class="nv">start_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>oldest
<a id="__codelineno-52-15" name="__codelineno-52-15" href="#__codelineno-52-15"></a><span class="nv">current_only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-52-16" name="__codelineno-52-16" href="#__codelineno-52-16"></a><span class="nv">evt_resolve_ad_obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-52-17" name="__codelineno-52-17" href="#__codelineno-52-17"></a><span class="nv">checkpointInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<a id="__codelineno-52-18" name="__codelineno-52-18" href="#__codelineno-52-18"></a><span class="nv">blacklist1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">EventCode</span><span class="o">=</span><span class="s2">&quot;4662&quot;</span><span class="w"> </span><span class="nv">Message</span><span class="o">=</span><span class="s2">&quot;Object Type:(?!\s*groupPolicyContainer)&quot;</span>
<a id="__codelineno-52-19" name="__codelineno-52-19" href="#__codelineno-52-19"></a><span class="nv">blacklist2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">EventCode</span><span class="o">=</span><span class="s2">&quot;566&quot;</span><span class="w"> </span><span class="nv">Message</span><span class="o">=</span><span class="s2">&quot;Object Type:(?!\s*groupPolicyContainer)&quot;</span>
<a id="__codelineno-52-20" name="__codelineno-52-20" href="#__codelineno-52-20"></a><span class="nv">renderXml</span><span class="o">=</span><span class="nb">false</span>
<a id="__codelineno-52-21" name="__codelineno-52-21" href="#__codelineno-52-21"></a>
<a id="__codelineno-52-22" name="__codelineno-52-22" href="#__codelineno-52-22"></a><span class="o">[</span>WinEventLog://System<span class="o">]</span>
<a id="__codelineno-52-23" name="__codelineno-52-23" href="#__codelineno-52-23"></a><span class="nv">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-52-24" name="__codelineno-52-24" href="#__codelineno-52-24"></a><span class="nv">start_from</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>oldest
<a id="__codelineno-52-25" name="__codelineno-52-25" href="#__codelineno-52-25"></a><span class="nv">current_only</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-52-26" name="__codelineno-52-26" href="#__codelineno-52-26"></a><span class="nv">checkpointInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span>
<a id="__codelineno-52-27" name="__codelineno-52-27" href="#__codelineno-52-27"></a><span class="nv">renderXml</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<p>On WS2019 host where Splunk Universal Forwarder is configured, navigate to </p>
<p><code>C:\Program Files\SplunkUniversalForwarder\etc\apps\Splunk_TA_windows\local</code></p>
<p>Copy <code>app.conf</code> and <code>inputs.conf</code> from <code>C:\Program Files\SplunkUniversalForwarder\etc\apps\Splunk_TA_windows\default</code></p>
<p>Edit <code>inputs.conf</code> (same as above)</p>
<p><a class="glightbox" href="image%2056.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2056.png" /></a></p>
<p>Restart Splunk Universal Forwarder</p>
<p>On PowerShell, change directory into <code>C:\program files\SplunkUniversalForwarder\bin</code></p>
<p>Run <code>./splunk restart</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">Administrator</span><span class="o">&gt;</span> <span class="n">cd</span> <span class="s2">&quot;C:\program files\SplunkUniversalForwarder</span><span class="se">\b</span><span class="s2">in&quot;</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="n">program</span> <span class="n">files</span>\<span class="n">SplunkUniversalForwarder</span>\<span class="nb">bin</span><span class="o">&gt;</span> <span class="o">./</span><span class="n">splunk</span> <span class="n">restart</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">SplunkForwarder</span><span class="p">:</span> <span class="n">Stopped</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">Splunk</span><span class="o">&gt;</span> <span class="n">Another</span> <span class="n">one</span><span class="o">.</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="n">Checking</span> <span class="n">prerequisites</span><span class="o">...</span>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a>        <span class="n">Checking</span> <span class="n">mgmt</span> <span class="n">port</span> <span class="p">[</span><span class="mi">8089</span><span class="p">]:</span> <span class="nb">open</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>        <span class="n">Checking</span> <span class="n">conf</span> <span class="n">files</span> <span class="k">for</span> <span class="n">problems</span><span class="o">...</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>        <span class="n">Done</span>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a>        <span class="n">Checking</span> <span class="n">default</span> <span class="n">conf</span> <span class="n">files</span> <span class="k">for</span> <span class="n">edits</span><span class="o">...</span>
<a id="__codelineno-53-12" name="__codelineno-53-12" href="#__codelineno-53-12"></a>        <span class="n">Validating</span> <span class="n">installed</span> <span class="n">files</span> <span class="n">against</span> <span class="n">hashes</span> <span class="kn">from</span> <span class="s1">&#39;C:\program files\SplunkUniversalForwarder\splunkforwarder-9.3.0-51ccf43db5bd-windows-64-manifest&#39;</span>
<a id="__codelineno-53-13" name="__codelineno-53-13" href="#__codelineno-53-13"></a>        <span class="n">All</span> <span class="n">installed</span> <span class="n">files</span> <span class="n">intact</span><span class="o">.</span>
<a id="__codelineno-53-14" name="__codelineno-53-14" href="#__codelineno-53-14"></a>        <span class="n">Done</span>
<a id="__codelineno-53-15" name="__codelineno-53-15" href="#__codelineno-53-15"></a><span class="n">All</span> <span class="n">preliminary</span> <span class="n">checks</span> <span class="n">passed</span><span class="o">.</span>
<a id="__codelineno-53-16" name="__codelineno-53-16" href="#__codelineno-53-16"></a>
<a id="__codelineno-53-17" name="__codelineno-53-17" href="#__codelineno-53-17"></a><span class="n">Starting</span> <span class="n">splunk</span> <span class="n">server</span> <span class="n">daemon</span> <span class="p">(</span><span class="n">splunkd</span><span class="p">)</span><span class="o">...</span>
<a id="__codelineno-53-18" name="__codelineno-53-18" href="#__codelineno-53-18"></a>
<a id="__codelineno-53-19" name="__codelineno-53-19" href="#__codelineno-53-19"></a><span class="n">SplunkForwarder</span><span class="p">:</span> <span class="n">Starting</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">2328</span><span class="p">)</span>
<a id="__codelineno-53-20" name="__codelineno-53-20" href="#__codelineno-53-20"></a><span class="n">Done</span>
</code></pre></div>
<p>Verify that data is being forwarded on wineventlog index</p>
<p>On web UI, navigate to Settings &gt; Indexes and refresh the page</p>
<p>Go to Apps &gt; Search &amp; Reporting &gt; Search for index=wineventlog</p>
<p><a class="glightbox" href="image%2057.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2057.png" /></a></p>
<p><a class="glightbox" href="image%2058.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2058.png" /></a></p>
<p>If the logs are not being indexed, try refreshing the web UI. </p>
<p>If searching for <code>index=wineventlog</code> does not return any result, try searching All time instead of Last 24 hours.</p>
<h2 id="edit-config-files-for-sysmon-app">Edit config files for Sysmon app</h2>
<p>On CentOS host where Splunk Enterprise is installed, change into <code>/opt/splunk/etc/deployment-apps/Splunk_TA_microsoft_sysmon/local</code> directory</p>
<p>Copy <code>app.conf</code> and <code>inputs.conf</code> from <code>/opt/splunk/etc/deployment-apps/Splunk_TA_microsoft_sysmon/default</code> directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nb">cd</span><span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_microsoft_sysmon/local
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_microsoft_sysmon/default/app.conf<span class="w"> </span>.
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_microsoft_sysmon/default/inputs.conf<span class="w"> </span>.
</code></pre></div>
<p>Make the following changes to <code>inputs.conf</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="n">nano</span> <span class="n">inputs</span><span class="o">.</span><span class="n">conf</span>
</code></pre></div>
<p>Note: your index name must match with the index name you created earlier</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="o">[</span>default<span class="o">]</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>sysmonlog
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="o">[</span>WinEventLog://Microsoft-Windows-Sysmon/Operational<span class="o">]</span>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="nv">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="nv">renderXml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="nb">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="o">[</span>WinEventLog://WEC-Sysmon<span class="o">]</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="nv">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="nv">renderXml</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="nb">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>XmlWinEventLog:Microsoft-Windows-Sysmon/Operational
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="nv">sourcetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>XmlWinEventLog:WEC-Sysmon
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="nv">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>WinEventLogForwardHost
</code></pre></div>
<p>On WS2019 host where Splunk Universal Forwarder is configured, navigate to </p>
<p><code>C:\Program Files\SplunkUniversalForwarder\etc\apps\Splunk_TA_microsoft_sysmon\local</code></p>
<p>Copy <code>app.conf</code> and <code>inputs.conf</code> from <code>C:\Program Files\SplunkUniversalForwarder\etc\apps\Splunk_TA_microsoft_sysmon\default</code></p>
<p>Edit <code>inputs.conf</code> (same as above) </p>
<p><a class="glightbox" href="image%2059.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2059.png" /></a></p>
<p>Restart Splunk Universal Forwarder</p>
<p>On PowerShell, change directory into <code>C:\program files\SplunkUniversalForwarder\bin</code></p>
<p>Run <code>./splunk restart</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="n">program</span> <span class="n">files</span>\<span class="n">SplunkUniversalForwarder</span>\<span class="nb">bin</span><span class="o">&gt;</span> <span class="o">./</span><span class="n">splunk</span> <span class="n">restart</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="n">SplunkForwarder</span><span class="p">:</span> <span class="n">Stopped</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="n">Splunk</span><span class="o">&gt;</span> <span class="n">Another</span> <span class="n">one</span><span class="o">.</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a>
<a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="n">Checking</span> <span class="n">prerequisites</span><span class="o">...</span>
<a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a>        <span class="n">Checking</span> <span class="n">mgmt</span> <span class="n">port</span> <span class="p">[</span><span class="mi">8089</span><span class="p">]:</span> <span class="nb">open</span>
<a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>        <span class="n">Checking</span> <span class="n">conf</span> <span class="n">files</span> <span class="k">for</span> <span class="n">problems</span><span class="o">...</span>
<a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a>        <span class="n">Done</span>
<a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a>        <span class="n">Checking</span> <span class="n">default</span> <span class="n">conf</span> <span class="n">files</span> <span class="k">for</span> <span class="n">edits</span><span class="o">...</span>
<a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a>        <span class="n">Validating</span> <span class="n">installed</span> <span class="n">files</span> <span class="n">against</span> <span class="n">hashes</span> <span class="kn">from</span> <span class="s1">&#39;C:\program files\SplunkUniversalForwarder\splunkforwarder-9.3.0-51ccf43db5bd-windows-64-manifest&#39;</span>
<a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>        <span class="n">All</span> <span class="n">installed</span> <span class="n">files</span> <span class="n">intact</span><span class="o">.</span>
<a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a>        <span class="n">Done</span>
<a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="n">All</span> <span class="n">preliminary</span> <span class="n">checks</span> <span class="n">passed</span><span class="o">.</span>
<a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a>
<a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="n">Starting</span> <span class="n">splunk</span> <span class="n">server</span> <span class="n">daemon</span> <span class="p">(</span><span class="n">splunkd</span><span class="p">)</span><span class="o">...</span>
<a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a>
<a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="n">SplunkForwarder</span><span class="p">:</span> <span class="n">Starting</span> <span class="p">(</span><span class="n">pid</span> <span class="mi">4824</span><span class="p">)</span>
<a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="n">Done</span>
<a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a>
<a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="n">PS</span> <span class="n">C</span><span class="p">:</span>\<span class="n">program</span> <span class="n">files</span>\<span class="n">SplunkUniversalForwarder</span>\<span class="nb">bin</span><span class="o">&gt;</span>
</code></pre></div>
<p>Verify that Sysmon logs are being indexed</p>
<p><a class="glightbox" href="image%2060.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2060.png" /></a></p>
<p>Search for <code>index=sysmonlog source=XmlWinEventLog:Microsoft-Windows-Sysmon/Operational</code></p>
<p><a class="glightbox" href="image%2061.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2061.png" /></a></p>
<h2 id="edit-config-files-for-unix-app-optional">Edit config files for Unix app (optional)</h2>
<p>On a Linux host where Splunk Enterprise is installed, change into /opt/splunk/etc/deployment-apps/Splunk_TA_nix/local*directory</p>
<p>Copy app.conf, inputs.conf and props.conf from /opt/splunk/etc/deployment-apps/Splunk_TA_nix/default directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>splunk@siem:/opt/splunk/etc/deployment-apps/Splunk_TA_nix/local$<span class="w"> </span>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_nix/default/app.conf<span class="w"> </span>.
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>splunk@siem:/opt/splunk/etc/deployment-apps/Splunk_TA_nix/local$<span class="w"> </span>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_nix/default/inputs.conf<span class="w"> </span>.
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>splunk@siem:/opt/splunk/etc/deployment-apps/Splunk_TA_nix/local$<span class="w"> </span>cp<span class="w"> </span>/opt/splunk/etc/deployment-apps/Splunk_TA_nix/default/props.conf<span class="w"> </span>.
</code></pre></div>
<p>Make the following changes to inputs.conf</p>
<p>Add your index name</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="o">[</span>default<span class="o">]</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="nv">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>unixlog
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>...
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="o">[</span>monitor:///var/log<span class="o">]</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="nv">whitelist</span><span class="o">=(</span><span class="se">\.</span>log<span class="p">|</span>log$<span class="p">|</span>messages<span class="p">|</span>secure<span class="p">|</span>auth<span class="p">|</span>mesg$<span class="p">|</span>cron$<span class="p">|</span>acpid$<span class="p">|</span><span class="se">\.</span>out<span class="o">)</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="nv">blacklist</span><span class="o">=(</span>lastlog<span class="p">|</span>anaconda<span class="se">\.</span>syslog<span class="o">)</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="nv">disabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a>...
</code></pre></div>
<p>On CentOShost where UF is configured, navigate to /opt/splunkforwarder/etc/apps/Splunk_TA_nix/local directory</p>
<p>Copy app.conf, inputs.conf and props.conf from /opt/splunkforwarder/etc/apps/Splunk_TA_nix/default directory</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">splunk</span><span class="nd">@siem3</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunkforwarder</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">Splunk_TA_nix</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">cp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunkforwarder</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">Splunk_TA_nix</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">app</span><span class="o">.</span><span class="n">conf</span> <span class="o">.</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="n">splunk</span><span class="nd">@siem3</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunkforwarder</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">Splunk_TA_nix</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">cp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunkforwarder</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">Splunk_TA_nix</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">inputs</span><span class="o">.</span><span class="n">conf</span> <span class="o">.</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="n">splunk</span><span class="nd">@siem3</span><span class="p">:</span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunkforwarder</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">Splunk_TA_nix</span><span class="o">/</span><span class="n">local</span><span class="err">$</span> <span class="n">cp</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">splunkforwarder</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">apps</span><span class="o">/</span><span class="n">Splunk_TA_nix</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">props</span><span class="o">.</span><span class="n">conf</span> <span class="o">.</span>
</code></pre></div>
<p>Edit inputs.conf (same as above)</p>
<p>Restart Splunk Universal Forwarder</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="nb">cd</span><span class="w"> </span>/opt/splunkuniversalforwarder/bin
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a>./splunk<span class="w"> </span>restart
</code></pre></div>
<p>Verify data being indexed</p>
<p><a class="glightbox" href="image%2062.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2062.png" /></a></p>
<p><a class="glightbox" href="image%2063.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2063.png" /></a></p>
<h2 id="annex-1-using-virtual-account-to-install-universal-forwarder-windows">Annex 1: Using Virtual Account to install Universal Forwarder (Windows)</h2>
<p>Selecting Virtual Account will create a service account called NT SERVICE\SplunkForwarder. For Sysmon Log Forwarding to work, NT SERVCIE\SplunkForwarder must be assigned as a member of Event Log Readers group through Group Policy. If your Windows host is not joined to a domain and you have technical issues with the Virtual Account, use Local System but note that this is not best security practice. </p>
<p><a class="glightbox" href="image%2064.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2064.png" /></a></p>
<p>Leave the values as default and click Next</p>
<p><a class="glightbox" href="image%2065.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2065.png" /></a></p>
<p>Leave the values as default and click Next (Windows Event Logs forwarding will be configured later)</p>
<p><a class="glightbox" href="image%2066.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2066.png" /></a></p>
<p>Create admin credentials</p>
<p><a class="glightbox" href="image%2030.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2030.png" /></a></p>
<p>Enter IP address of your Deployment Server (Splunk server) and port 8089</p>
<p><a class="glightbox" href="image%2031.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2031.png" /></a></p>
<p>Enter IP address of your Receiving Indexer (Splunk server) and port 9997</p>
<p><a class="glightbox" href="image%2032.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2032.png" /></a></p>
<p>Click Next and finish install. </p>
<p>Navigate to C:\Program Files\SplunkUniversalForwarder</p>
<p>Right-click and select properties</p>
<p>Verify that Splunk Universal Forwarder is configured to run by virtual account SplunkForwarder</p>
<p><a class="glightbox" href="image%2067.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2067.png" /></a></p>
<p>Open Group Policy Management</p>
<p>Right click on domain name and select Create a GPO in this domain and link it here</p>
<p><a class="glightbox" href="image%2068.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2068.png" /></a></p>
<p>Name it as Restricted Groups</p>
<p><a class="glightbox" href="image%2069.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2069.png" /></a></p>
<p>Right click on Restricted Groups and click Edit</p>
<p><a class="glightbox" href="image%2070.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2070.png" /></a></p>
<p>Navigate to Restricted Groups and Add Group</p>
<p><a class="glightbox" href="image%2071.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2071.png" /></a></p>
<p>Click Browse</p>
<p><a class="glightbox" href="image%2072.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2072.png" /></a></p>
<p>Type event log readers and click Check Names</p>
<p>Make sure that the names is underlined. Click OK</p>
<p><a class="glightbox" href="image%2073.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2073.png" /></a></p>
<p>Add NT SERVICE\SplunkForwarder as a member of this group</p>
<p>Click OK. Click Apply and OK</p>
<p><a class="glightbox" href="image%2074.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2074.png" /></a></p>
<p>Verify the configuration</p>
<p><a class="glightbox" href="image%2075.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2075.png" /></a></p>
<p>On Command Prompt as Administrator run gpupdate /force</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">Administrator</span><span class="o">&gt;</span><span class="n">gpupdate</span> <span class="o">/</span><span class="n">force</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="n">Updating</span> <span class="n">policy</span><span class="o">...</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="n">Computer</span> <span class="n">Policy</span> <span class="n">update</span> <span class="n">has</span> <span class="n">completed</span> <span class="n">successfully</span><span class="o">.</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="n">User</span> <span class="n">Policy</span> <span class="n">update</span> <span class="n">has</span> <span class="n">completed</span> <span class="n">successfully</span><span class="o">.</span>
</code></pre></div>
<p>Restart SplunkForwarder service. </p>
<p>Go to Services &gt; SplunkForwarder &gt; Right-click and select restart</p>
<p><a class="glightbox" href="image%2076.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2076.png" /></a></p>
<p>If Sysmon logs are not being ingested by Splunk, check Channel Access setting for Sysmon.</p>
<p>It is likely that SplunkForwarder is not added to the Channel Access.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">wevtutil</span> <span class="n">gl</span> <span class="s2">&quot;Microsoft-Windows-Sysmon/Operational&quot;</span>
</code></pre></div>
<p>Get SecurityIdentifier(sid) of SplunkForwarder by running this PowerShell script</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="err">$</span><span class="n">user</span> <span class="o">=</span> <span class="p">[</span><span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Principal</span><span class="o">.</span><span class="n">NTAccount</span><span class="p">]</span><span class="s2">&quot;NT SERVICE\SplunkForwarder&quot;</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="err">$</span><span class="n">sid</span> <span class="o">=</span> <span class="err">$</span><span class="n">user</span><span class="o">.</span><span class="n">Translate</span><span class="p">([</span><span class="n">System</span><span class="o">.</span><span class="n">Security</span><span class="o">.</span><span class="n">Principal</span><span class="o">.</span><span class="n">SecurityIdentifier</span><span class="p">])</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="n">Write</span><span class="o">-</span><span class="n">Output</span> <span class="err">$</span><span class="n">sid</span><span class="o">.</span><span class="n">Value</span>
</code></pre></div>
<p>Add SplunkForwarder to Channel Access bu running the command below</p>
<p>Note: add your sid of SplunkForwarder</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">wevtutil</span> <span class="n">sl</span> <span class="s2">&quot;Microsoft-Windows-Sysmon/Operational&quot;</span> <span class="o">/</span><span class="n">ca</span><span class="p">:</span><span class="s2">&quot;O:BAG:SYD:(A;;0x2;;;S-1-15-2-1)(A;;0x2;;;S-1-5-80-972488765-139171986-783781252-3188962990-3730692313)(A;;0xf0007;;;SY)(A;;0x7;;;BA)(A;;0x1;;;BO)(A;;0x1;;;SO)(A;;0x1;;;S-1-5-32-573)&quot;</span>
</code></pre></div>
<p>Restart SplunkForwarder Service</p>
<h2 id="annex-2-configure-splunk-universal-forwarder-on-linux-optional">Annex 2: Configure Splunk Universal Forwarder on Linux (optional)</h2>
<p>Note: this step is optional and is only applicable to Linux host. In this demonstration, Ubuntu was used for two hosts. Splunk Enterprise was configured in one host and Splunk Universal Forwarder was configured in another host. </p>
<p>Demonstration Setup</p>
<table>
<thead>
<tr>
<th><strong>Hostname</strong></th>
<th><strong>OS</strong></th>
<th><strong>Role</strong></th>
<th><strong>IP Address</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>siem</td>
<td>Ubuntu 22.04 LTS</td>
<td>Splunk Enterprise (server)</td>
<td>192.168.1.217</td>
</tr>
<tr>
<td>siem3</td>
<td>Ubuntu 22.04 LTS</td>
<td>Splunk Universal Forwarder (client)</td>
<td>192.168.1.117</td>
</tr>
</tbody>
</table>
<p>Download or transfer Splunk Universal Forwarder (tar archive)</p>
<p>Unpack the tar archive to /opt directory as a non-root user</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>sudo<span class="w"> </span>tar<span class="w"> </span>xvzf<span class="w"> </span>Splunk_UF_package_name.tgz<span class="w"> </span>-C<span class="w"> </span>/opt
</code></pre></div>
<p>Create a user called splunk and change the ownership of /opt/splunkforwarder/bin to splunk user</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="c1">#Create user splunk </span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>sudo<span class="w"> </span>su<span class="w"> </span>-
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>root@siem3:~#<span class="w"> </span>adduser<span class="w"> </span>splunk
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>Adding<span class="w"> </span>user<span class="w"> </span><span class="sb">`</span>splunk<span class="s1">&#39; ...</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="s1">Adding new group `splunk&#39;</span><span class="w"> </span><span class="o">(</span><span class="m">1001</span><span class="o">)</span><span class="w"> </span>...
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a>Adding<span class="w"> </span>new<span class="w"> </span>user<span class="w"> </span><span class="sb">`</span>splunk<span class="s1">&#39; (1001) with group `splunk&#39;</span><span class="w"> </span>...
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a>Creating<span class="w"> </span>home<span class="w"> </span>directory<span class="w"> </span><span class="sb">`</span>/home/splunk<span class="s1">&#39; ...</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="s1">Copying files from `/etc/skel&#39;</span><span class="w"> </span>...
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a>New<span class="w"> </span>password:<span class="w"> </span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>Retype<span class="w"> </span>new<span class="w"> </span>password:<span class="w"> </span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>passwd:<span class="w"> </span>password<span class="w"> </span>updated<span class="w"> </span>successfully
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>Changing<span class="w"> </span>the<span class="w"> </span>user<span class="w"> </span>information<span class="w"> </span><span class="k">for</span><span class="w"> </span>splunk
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a>Enter<span class="w"> </span>the<span class="w"> </span>new<span class="w"> </span>value,<span class="w"> </span>or<span class="w"> </span>press<span class="w"> </span>ENTER<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>default
<a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="w">    </span>Full<span class="w"> </span>Name<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>
<a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="w">    </span>Room<span class="w"> </span>Number<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>
<a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="w">    </span>Work<span class="w"> </span>Phone<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>
<a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="w">    </span>Home<span class="w"> </span>Phone<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>
<a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="w">    </span>Other<span class="w"> </span><span class="o">[]</span>:<span class="w"> </span>
<a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a>Is<span class="w"> </span>the<span class="w"> </span>information<span class="w"> </span>correct?<span class="w"> </span><span class="o">[</span>Y/n<span class="o">]</span><span class="w"> </span>Y<span class="w"> </span>
<a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a>
<a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="c1">#make the splunk user the owner of the splunk directory and verify</span>
<a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a>siem@siem3:~$<span class="w"> </span>sudo<span class="w"> </span>chown<span class="w"> </span>-R<span class="w"> </span>splunk:splunk<span class="w"> </span>/opt/splunkforwarder/
<a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a>siem@siem3:~$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/opt
<a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a>siem@siem3:/opt$<span class="w"> </span>ls<span class="w"> </span>-la
<a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a>total<span class="w"> </span><span class="m">12</span>
<a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a>drwxr-xr-x<span class="w">  </span><span class="m">3</span><span class="w"> </span>root<span class="w">   </span>root<span class="w">   </span><span class="m">4096</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">10</span>:05<span class="w"> </span>.
<a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a>drwxr-xr-x<span class="w"> </span><span class="m">20</span><span class="w"> </span>root<span class="w">   </span>root<span class="w">   </span><span class="m">4096</span><span class="w"> </span>Aug<span class="w"> </span><span class="m">13</span><span class="w"> </span><span class="m">07</span>:48<span class="w"> </span>..
<a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a>drwxr-xr-x<span class="w">  </span><span class="m">9</span><span class="w"> </span>splunk<span class="w"> </span>splunk<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Jul<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="m">10</span>:23<span class="w"> </span>splunkforwarder
<a id="__codelineno-67-29" name="__codelineno-67-29" href="#__codelineno-67-29"></a>
<a id="__codelineno-67-30" name="__codelineno-67-30" href="#__codelineno-67-30"></a>siem@siem3:/opt$<span class="w"> </span>su<span class="w"> </span>splunk
<a id="__codelineno-67-31" name="__codelineno-67-31" href="#__codelineno-67-31"></a>Password:<span class="w"> </span>
<a id="__codelineno-67-32" name="__codelineno-67-32" href="#__codelineno-67-32"></a>splunk@siem3:/opt$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>splunkforwarder/bin
<a id="__codelineno-67-33" name="__codelineno-67-33" href="#__codelineno-67-33"></a>splunk@siem3:/opt/splunkforwarder/bin$<span class="w"> </span>./splunk<span class="w"> </span>start<span class="w"> </span>--accept-license
<a id="__codelineno-67-34" name="__codelineno-67-34" href="#__codelineno-67-34"></a><span class="c1">#Create admin credentials (i.e. user account for UF, e.g. splunk:password)</span>
<a id="__codelineno-67-35" name="__codelineno-67-35" href="#__codelineno-67-35"></a>
<a id="__codelineno-67-36" name="__codelineno-67-36" href="#__codelineno-67-36"></a><span class="c1">#At some point after the setup, enable boot-start by running</span>
<a id="__codelineno-67-37" name="__codelineno-67-37" href="#__codelineno-67-37"></a>siem@siem3:/opt/splunkforwarder/bin$<span class="w"> </span>sudo<span class="w"> </span>./splunk<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>boot-start
</code></pre></div>
<p>Connect to the deployment server</p>
<p>Deployment server allows engineers/system admins to push out apps to multiple splunk instances and apps is easier way to handle changes (e.g. changes in config)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a>splunk@siem3:/opt/splunkforwarder/bin$<span class="w"> </span>./splunk<span class="w"> </span><span class="nb">set</span><span class="w"> </span>deploy-poll<span class="w"> </span><span class="m">192</span>.168.1.217:8089
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="c1">#Enter admin credentials</span>
</code></pre></div>
<p>Verify that there is deploymentclient.conf in /opt/splunkforwarder/etc/system/local</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a>cat<span class="w"> </span>/opt/splunkforwarder/etc/system/local/deploymentclient.conf
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>...
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="nv">targetUri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">192</span>.168.1.217:8089
</code></pre></div>
<p>Setup Splunk to send logs to another location by adding forward server</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>splunk@siem3:/opt/splunkforwarder/bin$<span class="w"> </span>./splunk<span class="w"> </span>add<span class="w"> </span>forward-server<span class="w"> </span><span class="m">192</span>.168.1.217:9997
</code></pre></div>
<p>Verify that there is outputs.conf in /opt/splunkforwarder/etc/system/local</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a>cat<span class="w"> </span>/opt/splunkforwarder/etc/system/local/outputs.conf
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>...
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="nv">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">192</span>.168.1.217:9997
</code></pre></div>
<p>Restart Splunk Forwarder for changes to take effect</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a>splunk@siem3:/opt/splunkforwarder/bin$<span class="w"> </span>./splunk<span class="w"> </span>restart
</code></pre></div>
<p>On web UI of Splunk Enterprise, go to settings, forwarder management.</p>
<p>You should be able to see your host machine that has been connected to your deployment server.</p>
<p>Try refreshing the web browser or restart Splunk Enterprise</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a>splunk@siem:/opt/splunk/bin$<span class="w"> </span>./splunk<span class="w"> </span>restart
</code></pre></div>
<p><a class="glightbox" href="image%2077.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2077.png" /></a></p>
<h2 id="annex-3-manual-configuration-of-data-input-on-linux-host">Annex 3: Manual configuration of data input on Linux host</h2>
<p>Note: this step is optional and is only applicable to Linux host. In this demonstration, apache2 have been started on siem3 host and apache logs are being forwarded.</p>
<p>Demonstration Setup</p>
<table>
<thead>
<tr>
<th><strong>Hostname</strong></th>
<th><strong>OS</strong></th>
<th><strong>Role</strong></th>
<th><strong>IP Address</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>siem</td>
<td>Ubuntu 22.04 LTS</td>
<td>Splunk Enterprise (server)</td>
<td>192.168.1.217</td>
</tr>
<tr>
<td>siem3</td>
<td>Ubuntu 22.04 LTS</td>
<td>Splunk Universal Forwarder (client)</td>
<td>192.168.1.117</td>
</tr>
</tbody>
</table>
<p>Add data that you want to forward to the UF using add monitor command</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a>./splunk<span class="w"> </span>add<span class="w"> </span>monitor<span class="w"> </span>-auth<span class="w"> </span>splunk:password<span class="w"> </span>/var/log/apache2
</code></pre></div>
<p>Verify that data is being indexed (i.e. forwarded) on Splunk Enterprise</p>
<p>Navigate to Splunk Enterprise web UI &gt; Search &amp; Reporting &gt; Data Summary</p>
<h2 id="introduction-to-splunk">Introduction to Splunk</h2>
<p>Splunk offers free training. You will need to create a user account to access <a href="https://www.splunk.com/en_us/training/course-catalog.html?sort=Newest&amp;filters=filterGroup1FreeCourses">free training materials</a>. The following content is available from the free course “Introduction to Splunk.” Alternatively, same contents are available from <a href="https://www.youtube.com/@SplunkHowTo">SplunkHowTo YouTube channel</a>.</p>
<h3 id="creating-reports">Creating Reports</h3>
<p>For demonstration, SSH Brute Force attack was simulated from Kali machine to FortiGate. Also SSH login attempts were made from other internal hosts to FortiGate. </p>
<p>On Splunk Enterprise web UI, search for Admin login failed on FortiGate</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="n">index</span><span class="o">=*</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">fgt_event</span> <span class="err">“</span><span class="n">Admin</span> <span class="n">login</span> <span class="n">failed</span><span class="err">”</span>
</code></pre></div>
<p>Select srcip form Interesting Fields, then select Top values</p>
<p><a class="glightbox" href="image%2078.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2078.png" /></a></p>
<p>This will visualise data as a bar chart. Save As Report</p>
<p><a class="glightbox" href="image%2079.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2079.png" /></a></p>
<p>Set Title as Security_Report_Failed_SSH_Login_Attempts</p>
<p>Set Content as Bar Chart</p>
<p>Select Yes for Time Range Picker</p>
<p>Save</p>
<p><a class="glightbox" href="image%2080.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2080.png" /></a></p>
<p>Select View</p>
<p><a class="glightbox" href="image%2081.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2081.png" /></a></p>
<p>Note Time Range Picker can be adjusted to your preference (e.g. All time or Last 24 hours)</p>
<p>Select Reports</p>
<p><a class="glightbox" href="image%2082.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2082.png" /></a></p>
<p>Navigate to Reports tab. Edit Permissions for Security_Report_Failed_SSH_Login_Attempts.</p>
<p><a class="glightbox" href="image%2083.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2083.png" /></a></p>
<p>Select following options:</p>
<ul>
<li>Display For App</li>
<li>Run As User</li>
<li>Assign Read to Everyone</li>
</ul>
<p>Click Save</p>
<p><a class="glightbox" href="image%2084.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2084.png" /></a></p>
<p>Edit Schedule (optional)</p>
<p>Scheduling Report can reduce strain on your environment caused by repeatedly running new ad-hoc searches</p>
<p>Select Schedule and Time Range of your preference</p>
<p>click Save</p>
<p><a class="glightbox" href="image%2085.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2085.png" /></a></p>
<p><a class="glightbox" href="image%2086.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2086.png" /></a></p>
<h3 id="creating-alerts">Creating Alerts</h3>
<p>On Splunk Enterprise web UI, search for Admin login failed on FortiGate.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="n">index</span><span class="o">=*</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">fgt_event</span> <span class="s2">&quot;Admin login failed&quot;</span>
</code></pre></div>
<p>Save As Alert</p>
<p><a class="glightbox" href="image%2087.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2087.png" /></a></p>
<p>Set Title as FortiGate Login Failures</p>
<p>Set Permissions to Private</p>
<p>Set Alert type as Schedules to Run every hours and Expire after 24 hours</p>
<p>Set Trigger Conditions to trigger alert when Number of Results is greater than 10 and trigger Once.</p>
<p>Select Throttle (after an alert is triggered, subsequent alerts will not be triggered until after the throttle period).</p>
<p>Suppress trigger for 60 seconds</p>
<p>Set Trigger Actions to Add to Trigger Alerts with High Severity.</p>
<p>Click Save. </p>
<p><a class="glightbox" href="image%2088.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2088.png" /></a></p>
<p><a class="glightbox" href="image%2089.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2089.png" /></a></p>
<p>Click Permissions</p>
<p><a class="glightbox" href="image%2090.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2090.png" /></a></p>
<p>Select Display For App</p>
<p>Assign Read access to Everyone</p>
<p>Click Save</p>
<p><a class="glightbox" href="image%2091.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2091.png" /></a></p>
<p>Select Edit Alert again</p>
<p><a class="glightbox" href="image%2092.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2092.png" /></a></p>
<p>Change Alert type to Real-time</p>
<p>Suppress all fields containing field value by entering a wildcard</p>
<p><a class="glightbox" href="image%2093.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2093.png" /></a></p>
<p>Click Save</p>
<p>View Triggered Alerts</p>
<p><a class="glightbox" href="image%2094.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2094.png" /></a></p>
<p>Alternatively, Triggered Alerts can be viewed on the Activity tab</p>
<p><a class="glightbox" href="image%2095.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2095.png" /></a></p>
<p>Alerts and Reports can be viewed from Setting &gt; Searches, reports, and alerts</p>
<p><a class="glightbox" href="image%2096.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2096.png" /></a></p>
<p>Alerts can also be viewed from the Alerts tab</p>
<p><a class="glightbox" href="image%2097.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2097.png" /></a></p>
<h3 id="creating-dashboards">Creating Dashboards</h3>
<p>On Splunk Enterprise web UI, search for Admin login failed events are generated on FortiGate</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="n">index</span><span class="o">=*</span> <span class="n">sourcetype</span><span class="o">=</span><span class="n">fgt_event</span> <span class="s2">&quot;Admin login failed&quot;</span>
</code></pre></div>
<p><a class="glightbox" href="image%2098.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2098.png" /></a></p>
<p>From the Interesting Fields panel, Select user and Top values. Alternatively, you can filter on srcip Top values if there are multiple source IP addresses.</p>
<p><a class="glightbox" href="image%2099.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%2099.png" /></a></p>
<p>This will generate a Visualisation that is most suitable for our data</p>
<p><a class="glightbox" href="image%20100.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20100.png" /></a></p>
<p>Select Bar Chart and select Pie Chart</p>
<p><a class="glightbox" href="image%20101.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20101.png" /></a></p>
<p>Click Save As and select New Dashboard</p>
<p><a class="glightbox" href="image%20102.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20102.png" /></a></p>
<p>Set Dashboard Title and Permissions.</p>
<p>Select Classic Dashboards (we will explore Dashboard Studio later)</p>
<p>Set Panel Title </p>
<p>Set Visualization Type as Pie Chart</p>
<p>Save to Dashboard</p>
<p><a class="glightbox" href="image%20103.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20103.png" /></a></p>
<p>View Dashboard</p>
<p><a class="glightbox" href="image%20104.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20104.png" /></a></p>
<p><a class="glightbox" href="image%20105.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20105.png" /></a></p>
<p>Go back to Search and search for <code>index=* sourcetype=fgt_event “Admin login”</code></p>
<p>In the Interesting Fields panel, select logdesc, then Top values by time</p>
<p><a class="glightbox" href="image%20106.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20106.png" /></a></p>
<p>This allows us to see login trends over time as a line chart (select Last 24 hours)</p>
<p><a class="glightbox" href="image%20107.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20107.png" /></a></p>
<p>Select Format</p>
<p>Select Legend, then Legend Position as Left</p>
<p><a class="glightbox" href="image%20108.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20108.png" /></a></p>
<p>Select General</p>
<p>Select Min/Max in Show Data Values</p>
<p><a class="glightbox" href="image%20109.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20109.png" /></a></p>
<p>Save As Existing Dashboard</p>
<p>Select FortiGate Logins</p>
<p>Save to Dashboard</p>
<p><a class="glightbox" href="image%20110.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20110.png" /></a></p>
<p>View Dashboard</p>
<p><a class="glightbox" href="image%20111.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20111.png" /></a></p>
<p><a class="glightbox" href="image%20112.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20112.png" /></a></p>
<p>Click Edit on top right</p>
<p>Add Panel</p>
<p>Select New from Report </p>
<p>Select Security_Report_Failed_SSH_Login_Attempts</p>
<p><a class="glightbox" href="image%20113.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20113.png" /></a></p>
<p>Select Add to Dashboard</p>
<p><a class="glightbox" href="image%20114.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20114.png" /></a></p>
<p>Drag and Drop Bar Chart next to the Pie Chart</p>
<p>Edit Drilldown on the Pie Chart</p>
<p><a class="glightbox" href="image%20115.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20115.png" /></a></p>
<p>Set Drilldown Action On click to Link to Search </p>
<p>click Apply</p>
<p><a class="glightbox" href="image%20116.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20116.png" /></a></p>
<p>Save the Dashboard</p>
<p><a class="glightbox" href="image%20117.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20117.png" /></a></p>
<h3 id="dashboard-studio">Dashboard Studio</h3>
<p>Make sure FortiGate Logins Dashboard is opened</p>
<p>Select Clone in Dashboard Studio</p>
<p><a class="glightbox" href="image%20118.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20118.png" /></a></p>
<p>Set Title as FortiGate Logins - Dashboard Studio</p>
<p>Select Grid layout</p>
<p>Click Convert &amp; Save</p>
<p><a class="glightbox" href="image%20119.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20119.png" /></a></p>
<p>Click Save</p>
<p>If Save button is greyed out, toggle Add submit button then click Save.</p>
<p>Revert the changes then click Save. </p>
<p>Click View</p>
<p><a class="glightbox" href="image%20120.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20120.png" /></a></p>
<p><a class="glightbox" href="image%20121.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="image%20121.png" /></a></p>
<h2 id="references">References</h2>
<ul>
<li>https://youtu.be/gNeF_mT6Eng?si=No3aBK1EDt_LuK80</li>
<li>https://youtu.be/Wze0yXsMKVM?si=N6Y4iW3m5ewxD1Hv</li>
<li>https://youtu.be/Iol1CHyv23A?si=ZWXFI-QOZVA8BUaa</li>
<li>https://youtu.be/zFosqdAadJg?si=mn5HtZHhud3jkcPR</li>
<li>https://docs.splunk.com/Documentation/Splunk/9.3.0/Installation/Whatsinthismanual</li>
<li>https://community.splunk.com/t5/Getting-Data-In/Sysmon-events-not-getting-indexed/m-p/688793?lightbox-message-images-688793=31015i33DABC9A02E482CD#M114683</li>
<li>https://youtu.be/1Ur3xDNaE4s?si=Dfh4-4PDkOccbnTR</li>
<li>https://splunk.github.io/splunk-connect-for-syslog/main/</li>
<li>https://gitlab.com/J-C-B/community-splunk-scripts/-/tree/master/</li>
<li>https://youtu.be/zWkGVnsNY8M?si=9iNqCFLlktpQq6qQ</li>
<li>https://youtu.be/Xepw_Xk9HX8?si=-D53cGVAs7Ckcrp6</li>
<li>https://youtu.be/8jvEmAmQNug?si=tc2tzJh4uOG9I62V</li>
<li>https://youtu.be/uQUAvY5M3RU?si=JKk_M_60LLsvk0w6</li>
<li>https://youtu.be/2kU1ZTAZphY?si=H3zP0QD9m8MmL2bG</li>
</ul>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../understanding-SIEM/understanding-SIEM.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Understanding SIEM">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Understanding SIEM
              </div>
            </div>
          </a>
        
        
          
          <a href="../wazuh/wazuh.html" class="md-footer__link md-footer__link--next" aria-label="Next: Wazuh">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Wazuh
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2024 <a href="https://github.com/cyberdefencekit"  target="_blank" rel="noopener">Cyber Defence Kit - Joseph Jee</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/cyberdefencekit" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1M480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2m-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3m-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "header.autohide", "announce.dismiss", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "navigation.expand", "search.highlight", "search.share", "search.suggest", "toc.integrate"], "search": "../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.525ec568.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>